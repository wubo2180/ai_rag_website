# 文档管理功能使用指南

## 📚 功能概述

文档管理系统现在支持以下功能：

### 1. ✅ 分类管理
- **按分类组织文档**：可以创建多个文档分类
- **分类统计**：显示每个分类下的文档数量和文件夹数量
- **分类颜色标识**：每个分类可以设置不同的颜色标识

### 2. ✅ 文件夹管理
- **创建文件夹**：在分类下创建文件夹组织文档
- **子文件夹**：支持在文件夹下创建子文件夹（多级目录）
- **文件夹导航**：通过面包屑导航在文件夹间切换
- **文件夹删除**：可删除空文件夹

### 3. ✅ 文档上传
- **单文件上传**：上传单个文档到指定分类和文件夹
- **批量上传**：一次性上传多个文件到同一文件夹
- **自动分类**：根据文件扩展名自动识别文件类型

### 4. ✅ 文档查看和下载
- **文档查看**：查看文档详细信息（文件名、大小、上传时间等）
- **文档下载**：支持下载任何已上传的文档
- **访问记录**：系统自动记录文档的查看和下载行为

---

## 🚀 使用流程

### 步骤1：创建分类
1. 点击页面顶部的 **"+ 新建分类"** 按钮
2. 填写分类信息：
   - **分类名称**：如"技术文档"、"研究报告"等
   - **分类颜色**：选择一个颜色标识（可选）
   - **描述**：简要描述该分类的用途（可选）
3. 点击 **"创建"** 按钮

### 步骤2：选择分类
- 在"文档分类"区域点击任一分类卡片
- 分类被选中后会高亮显示
- 下方会显示该分类下的文件夹和文档

### 步骤3：创建文件夹（可选）
1. 选择分类后，点击 **"新建文件夹"** 按钮
2. 输入文件夹名称和描述
3. 点击 **"创建"** 按钮
4. 双击文件夹可进入文件夹内部
5. 在文件夹内可以继续创建子文件夹

### 步骤4：上传文档

#### 方式A：单文件上传
1. 点击 **"上传文档"** 按钮
2. 填写文档标题（可选，留空则使用文件名）
3. 点击 **"选择文件"** 选择要上传的文件
4. 填写文档描述（可选）
5. 点击 **"上传"** 按钮

#### 方式B：批量上传
1. 进入目标文件夹（或停留在分类根目录）
2. 点击 **"批量上传"** 按钮
3. 点击 **"选择多个文件"**，可以一次选择多个文件
4. 文件列表中会显示所有选中的文件
5. 点击 **"上传 X 个文件"** 按钮开始批量上传

### 步骤5：查看和下载文档
1. 在文档列表中找到目标文档
2. 点击操作列的按钮：
   - **👁️ 查看**：打开文档详情对话框
   - **⬇️ 下载**：直接下载文档到本地
   - **🗑️ 删除**：删除文档（需确认）

---

## 📂 文件夹导航

### 面包屑导航
- 页面顶部显示当前路径：`分类名 / 文件夹1 / 文件夹2`
- 点击面包屑中的任意节点可快速返回上级目录
- 点击 🏠 图标返回分类根目录

### 文件夹操作
- **打开文件夹**：双击文件夹卡片 或 点击"打开"按钮
- **删除文件夹**：点击"删除"按钮（仅空文件夹可删除）

---

## 🎯 功能特性

### 1. 按分类显示
- **自动过滤**：选择分类后只显示该分类下的内容
- **实时统计**：显示文档数量和文件夹数量
- **多分类支持**：可以创建多个分类独立管理

### 2. 文件夹层级
```
分类A
├── 文件夹1
│   ├── 子文件夹1-1
│   │   ├── 文档1.pdf
│   │   └── 文档2.docx
│   └── 子文件夹1-2
│       └── 文档3.xlsx
├── 文件夹2
│   └── 文档4.ppt
└── 文档5.txt (分类根目录)
```

### 3. 支持的文件类型
| 文件类型 | 扩展名 | 图标 |
|---------|--------|------|
| PDF文档 | .pdf | 📄 |
| Word文档 | .doc, .docx | 📝 |
| Excel表格 | .xls, .xlsx | 📈 |
| PowerPoint | .ppt, .pptx | 📊 |
| 文本文件 | .txt, .md | 📋 |
| 图片文件 | .jpg, .png, .gif | 🖼️ |
| 其他文件 | 其他格式 | 📁 |

### 4. 文档信息
每个文档显示以下信息：
- **文件名**：文档标题
- **文件类型**：图标表示
- **文件大小**：自动转换为易读格式（KB、MB等）
- **上传者**：上传文档的用户名
- **上传时间**：精确到秒

---

## 🔧 API端点

### 分类相关
```
GET    /api/documents/categories/                    # 获取分类列表
POST   /api/documents/categories/                    # 创建新分类
GET    /api/documents/categories/{id}/               # 获取分类详情
PUT    /api/documents/categories/{id}/               # 更新分类
DELETE /api/documents/categories/{id}/               # 删除分类
GET    /api/documents/categories/{id}/documents/     # 获取分类下的文档和文件夹
```

### 文件夹相关
```
GET    /api/documents/folders/                       # 获取文件夹列表
POST   /api/documents/folders/                       # 创建新文件夹
GET    /api/documents/folders/{id}/                  # 获取文件夹详情
PUT    /api/documents/folders/{id}/                  # 更新文件夹
DELETE /api/documents/folders/{id}/                  # 删除文件夹
```

### 文档相关
```
POST   /api/documents/upload/                        # 上传单个文档
POST   /api/documents/batch-upload/                  # 批量上传文档
GET    /api/documents/list/                          # 获取文档列表
GET    /api/documents/{id}/                          # 获取文档详情
GET    /api/documents/{id}/download/                 # 下载文档
PUT    /api/documents/{id}/update/                   # 更新文档信息
DELETE /api/documents/{id}/delete/                   # 删除文档
```

---

## 💡 使用技巧

### 1. 批量上传最佳实践
- **按项目组织**：为每个项目创建一个文件夹
- **批量上传同类文件**：将相同类型的文档一次性上传
- **命名规范**：使用有意义的文件名，便于后续查找

### 2. 分类建议
- **按文档类型分类**：技术文档、财务报表、合同文件等
- **按项目分类**：项目A、项目B、项目C等
- **按时间分类**：2024年文档、2025年文档等
- **按部门分类**：研发部、市场部、财务部等

### 3. 文件夹结构建议
```
技术文档 (分类)
├── API文档 (文件夹)
│   ├── RESTful API
│   └── GraphQL API
├── 数据库设计 (文件夹)
│   ├── ER图
│   └── 表结构
└── 架构设计 (文件夹)
    ├── 系统架构
    └── 部署架构
```

---

## ⚠️ 注意事项

### 文件大小限制
- 单个文件最大 **50MB**
- 批量上传没有总大小限制，但建议不超过 500MB

### 文件夹删除
- 只能删除**空文件夹**（不包含文档和子文件夹）
- 删除前需要先移动或删除文件夹内的所有内容

### 权限控制
- 普通用户只能看到自己上传的文档和公开文档
- 管理员可以看到所有文档
- 只能删除自己上传的文档（管理员除外）

---

## 🐛 常见问题

### Q1: 为什么看不到其他用户的文档？
**A**: 默认情况下，用户只能看到自己上传的文档。如需分享文档，可以：
- 将文档设置为"公开"
- 或联系管理员查看

### Q2: 批量上传失败怎么办？
**A**: 检查以下几点：
1. 文件大小是否超过限制
2. 文件格式是否支持
3. 网络连接是否稳定
4. 是否有足够的存储空间

### Q3: 如何组织大量文档？
**A**: 建议：
1. 创建清晰的分类结构
2. 使用文件夹分层组织
3. 给文档添加描述性标题
4. 定期整理和归档旧文档

### Q4: 文件夹中有子文件夹可以删除吗？
**A**: 不能。必须先删除所有子文件夹和文档，才能删除父文件夹。

---

## 🔄 数据库变更

已应用以下数据库迁移：

```bash
# 迁移文件
apps/documents/migrations/0002_documentfolder_document_folder.py

# 新增表
- DocumentFolder: 文件夹表
  
# 新增字段
- Document.folder: 文档所属文件夹（外键）
```

---

## 📊 测试建议

### 测试场景1：基本文档管理
1. 创建3个分类：技术文档、财务文件、人事资料
2. 在每个分类下创建2个文件夹
3. 上传5个不同格式的文档
4. 测试查看和下载功能

### 测试场景2：批量上传
1. 选择一个文件夹
2. 批量上传10个文档
3. 验证所有文档都正确上传到目标文件夹

### 测试场景3：文件夹导航
1. 创建3级文件夹结构：分类/文件夹1/子文件夹1-1
2. 测试面包屑导航
3. 测试在不同层级上传文档

---

## 🎉 功能总结

✅ **已实现功能**：
- [x] 按分类名称显示文档和文件夹
- [x] 文档查看功能（详细信息展示）
- [x] 文档下载功能
- [x] 文件夹创建功能（支持多级）
- [x] 批量文件上传
- [x] 文件夹导航（面包屑）
- [x] 分类颜色标识
- [x] 实时统计信息

**未来可扩展功能**：
- [ ] 文档全文搜索
- [ ] 文档标签系统
- [ ] 文档分享链接
- [ ] 文档版本控制
- [ ] 文档在线预览
- [ ] 回收站功能

---

**创建日期**: 2025年10月20日  
**版本**: v1.0
