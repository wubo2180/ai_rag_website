# 材料知识图谱系统使用指南

## 📦 问题解决

### ✅ 已解决：ECharts 依赖安装

**问题**：`Failed to resolve import "echarts" from "src/views/KnowledgeGraph.vue"`

**解决方案**：已成功安装 ECharts 6.0.0
```bash
cd frontend
npm install echarts
```

---

## 🚀 快速启动

### 方法一：使用启动脚本（推荐）

双击运行：
```
ai_rag_website/start_all.bat
```

这将自动启动：
- ✅ Django 后端服务（端口 8000）
- ✅ Vue 前端服务（端口 5173）

### 方法二：手动启动

#### 1. 启动后端
```bash
cd ai_rag_website/backend
python manage.py runserver
```

#### 2. 启动前端（新终端）
```bash
cd ai_rag_website/frontend
npm run dev
```

---

## 🌐 访问地址

- **前端界面**: http://localhost:5173
- **后端API**: http://localhost:8000
- **Django管理后台**: http://localhost:8000/admin

### 知识图谱相关URL

| 功能 | URL | 说明 |
|------|-----|------|
| 知识图谱页面 | http://localhost:5173/knowledge-graph | 前端可视化界面 |
| 完整图谱数据 | http://localhost:8000/api/kg/graph/full_graph/ | 获取完整图谱JSON |
| 原材料列表 | http://localhost:8000/api/kg/raw-materials/ | CRUD API |
| 中间体列表 | http://localhost:8000/api/kg/intermediates/ | CRUD API |
| 配方列表 | http://localhost:8000/api/kg/formulas/ | CRUD API |
| 性能数据 | http://localhost:8000/api/kg/performances/ | CRUD API |

---

## 📊 知识图谱功能

### 1. 四级数据链
```
原材料 → 中间体 → 配方 → 性能
  🧪   →   ⚗️   →  📋  →  📊
```

### 2. 演示数据
系统已初始化以下数据：
- ✅ 6种原材料（羟基硅油、KH-550偶联剂、气相二氧化硅等）
- ✅ 2种中间体（硅烷封端预聚物、硅油-填料母料）
- ✅ 2个配方（通用型密封胶、高强度密封胶）
- ✅ 3条性能测试记录

### 3. 可视化特性
- 🔄 **力导向布局**：自动排列节点
- 🖱️ **拖拽节点**：手动调整位置
- 🔍 **缩放平移**：鼠标滚轮缩放，拖拽平移
- 📋 **点击详情**：点击节点查看完整信息
- 📊 **实时统计**：显示各类实体数量

### 4. 节点类型
| 类型 | 图标 | 颜色 | 形状 |
|------|------|------|------|
| 原材料 | 🧪 | 蓝色 | 圆形 |
| 中间体 | ⚗️ | 绿色 | 矩形 |
| 配方 | 📋 | 黄色 | 圆角矩形 |
| 性能数据 | 📊 | 红色 | 菱形 |

---

## 🔧 自定义配置

### 修改端口

**后端端口**（默认8000）：
```bash
python manage.py runserver 0.0.0.0:8080
```

**前端端口**（默认5173）：
编辑 `frontend/vite.config.js`:
```javascript
export default defineConfig({
  server: {
    port: 3000  // 修改为你想要的端口
  }
})
```

### API基础URL

如果修改了后端端口，需要更新前端API地址：
编辑 `frontend/src/views/KnowledgeGraph.vue`，修改第200行：
```javascript
const response = await axios.get('http://localhost:8000/api/kg/graph/full_graph/')
// 改为你的端口，例如：
// const response = await axios.get('http://localhost:8080/api/kg/graph/full_graph/')
```

---

## 📝 常见问题

### Q1: 点击知识图谱按钮后页面空白？
**A**: 确保：
1. ✅ ECharts 已安装（npm install echarts）
2. ✅ 后端服务正在运行（端口8000）
3. ✅ 演示数据已初始化（python manage.py init_kg_demo）

### Q2: 图谱不显示或显示"加载图谱失败"？
**A**: 检查：
1. 打开浏览器开发者工具（F12）查看Console错误
2. 确认后端API可访问：访问 http://localhost:8000/api/kg/graph/full_graph/
3. 检查是否有CORS错误（应该已配置好）

### Q3: 如何添加更多数据？
**A**: 三种方式：
1. **Django管理后台**：http://localhost:8000/admin
2. **API调用**：使用POST请求添加数据
3. **修改演示脚本**：编辑 `backend/apps/knowledge/management/commands/init_kg_demo.py`

### Q4: 如何清空并重新初始化数据？
**A**: 
```bash
cd backend
python manage.py init_kg_demo
```
脚本会自动清除旧数据并创建新的演示数据。

---

## 🎯 下一步开发

根据待办列表，接下来可以实现：

### 1. 智能检索功能
- [ ] 按材料属性过滤（供应商、价格范围、密度等）
- [ ] 按性能要求搜索配方（拉伸强度、硬度等）
- [ ] 全文搜索材料名称和编号

### 2. AI推荐系统
- [ ] 根据目标性能推荐配方
- [ ] 基于历史数据预测性能
- [ ] 原材料替代建议

### 3. 数据分析
- [ ] 配方成本分析
- [ ] 性能趋势分析
- [ ] 材料使用频率统计

---

## 📞 技术支持

如遇问题，请检查：
1. **后端日志**：Django终端输出
2. **前端日志**：浏览器Console（F12）
3. **网络请求**：浏览器Network标签
4. **数据库**：确认migration已应用

---

## 📄 文件结构

```
ai_rag_website/
├── backend/
│   ├── apps/knowledge/
│   │   ├── models.py                    # 数据模型
│   │   ├── kg_views.py                  # API视图
│   │   ├── serializers.py               # 序列化器
│   │   ├── kg_urls.py                   # URL路由
│   │   └── management/commands/
│   │       └── init_kg_demo.py          # 演示数据脚本
│   └── manage.py
├── frontend/
│   ├── src/
│   │   ├── views/
│   │   │   └── KnowledgeGraph.vue       # 知识图谱页面
│   │   ├── components/
│   │   │   └── Navigation.vue           # 导航组件
│   │   └── router/index.js              # 路由配置
│   └── package.json
└── start_all.bat                        # 一键启动脚本
```

---

**系统版本信息**
- Django: 5.2.7
- Vue: 3.4.0
- ECharts: 6.0.0
- Element Plus: 2.4.4
- Python: 3.13

**创建日期**: 2025年10月19日
