<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDN 加载测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>CDN 库加载测试</h1>
    
    <div id="status-container">
        <p>正在检测 JavaScript 库...</p>
    </div>

    <!-- Markdown渲染库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <!-- 代码高亮库 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <!-- DOMPurify -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

    <script>
        window.addEventListener('load', function() {
            const container = document.getElementById('status-container');
            container.innerHTML = '';
            
            // 检查 marked.js
            const markedStatus = document.createElement('div');
            markedStatus.className = 'status ' + (typeof marked !== 'undefined' ? 'success' : 'error');
            markedStatus.innerHTML = typeof marked !== 'undefined' 
                ? '✅ marked.js 已加载 (版本: ' + (marked.version || 'unknown') + ')'
                : '❌ marked.js 未加载';
            container.appendChild(markedStatus);
            
            // 检查 highlight.js
            const hlStatus = document.createElement('div');
            hlStatus.className = 'status ' + (typeof hljs !== 'undefined' ? 'success' : 'error');
            hlStatus.innerHTML = typeof hljs !== 'undefined' 
                ? '✅ highlight.js 已加载 (版本: ' + (hljs.versionString || 'unknown') + ')'
                : '❌ highlight.js 未加载';
            container.appendChild(hlStatus);
            
            // 检查 DOMPurify
            const purifyStatus = document.createElement('div');
            purifyStatus.className = 'status ' + (typeof DOMPurify !== 'undefined' ? 'success' : 'error');
            purifyStatus.innerHTML = typeof DOMPurify !== 'undefined' 
                ? '✅ DOMPurify 已加载 (版本: ' + (DOMPurify.version || 'unknown') + ')'
                : '❌ DOMPurify 未加载';
            container.appendChild(purifyStatus);
            
            // 测试 Markdown 渲染
            if (typeof marked !== 'undefined' && typeof DOMPurify !== 'undefined') {
                const testMarkdown = `
# 测试标题

这是一个**粗体**文本和*斜体*文本。

## 表格测试

| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 数据1 | 数据2 | 数据3 |
| 数据4 | 数据5 | 数据6 |

## 代码测试

\`\`\`python
def hello():
    print("Hello, World!")
\`\`\`
`;
                
                const testDiv = document.createElement('div');
                testDiv.innerHTML = '<h2>Markdown 渲染测试:</h2>';
                container.appendChild(testDiv);
                
                try {
                    const html = marked.parse(testMarkdown);
                    const clean = DOMPurify.sanitize(html);
                    const resultDiv = document.createElement('div');
                    resultDiv.innerHTML = clean;
                    resultDiv.style.border = '1px solid #ddd';
                    resultDiv.style.padding = '15px';
                    resultDiv.style.marginTop = '10px';
                    resultDiv.style.borderRadius = '5px';
                    container.appendChild(resultDiv);
                    
                    // 代码高亮
                    if (typeof hljs !== 'undefined') {
                        resultDiv.querySelectorAll('pre code').forEach((block) => {
                            hljs.highlightBlock(block);
                        });
                    }
                } catch(e) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'status error';
                    errorDiv.innerHTML = '❌ Markdown 渲染出错: ' + e.message;
                    container.appendChild(errorDiv);
                }
            }
            
            // 显示控制台信息
            console.log('marked:', typeof marked !== 'undefined' ? marked : 'NOT LOADED');
            console.log('hljs:', typeof hljs !== 'undefined' ? hljs : 'NOT LOADED');
            console.log('DOMPurify:', typeof DOMPurify !== 'undefined' ? DOMPurify : 'NOT LOADED');
        });
    </script>
</body>
</html>
