<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Markdownæ¸²æŸ“æµ‹è¯•</title>
    <!-- Markdownæ¸²æŸ“åº“ - ä½¿ç”¨å¤šä¸ªCDNæºä½œä¸ºå¤‡é€‰ -->
    <script src="https://unpkg.com/marked@11.1.1/marked.min.js" 
            onerror="this.onerror=null; this.src='https://cdn.bootcdn.net/ajax/libs/marked/11.1.1/marked.min.js'"></script>
    <!-- ä»£ç é«˜äº®åº“ -->
    <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/github.min.css" 
          onerror="this.onerror=null; this.href='https://cdn.bootcdn.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css'">
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"
            onerror="this.onerror=null; this.src='https://cdn.bootcdn.net/ajax/libs/highlight.js/11.9.0/highlight.min.js'"></script>
    <!-- DOMPurify - é˜²æ­¢XSSæ”»å‡» -->
    <script src="https://unpkg.com/dompurify@3.0.6/dist/purify.min.js"
            onerror="this.onerror=null; this.src='https://cdn.bootcdn.net/ajax/libs/dompurify/3.0.6/purify.min.js'"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
        }
        #output {
            background: #f1f3f4;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        table thead tr {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        table th, table td {
            padding: 12px 15px;
            border: 1px solid #ddd;
        }
        table tbody tr:nth-of-type(even) {
            background-color: #f8f9fa;
        }
        pre {
            background: #282c34;
            color: #abb2bf;
            padding: 1em;
            border-radius: 8px;
            overflow-x: auto;
        }
        code {
            background: #f4f4f4;
            color: #e83e8c;
            padding: 2px 6px;
            border-radius: 4px;
        }
        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Markdownæ¸²æŸ“æµ‹è¯•</h1>
    
    <div id="status"></div>
    
    <button onclick="testTable()">æµ‹è¯•è¡¨æ ¼</button>
    <button onclick="testCode()">æµ‹è¯•ä»£ç </button>
    <button onclick="testMixed()">æµ‹è¯•æ··åˆæ ¼å¼</button>
    
    <div id="output"></div>

    <script>
        // æ£€æŸ¥åº“æ˜¯å¦åŠ è½½
        window.addEventListener('load', function() {
            let status = '<div class="status success">';
            let allLoaded = true;
            
            if (typeof marked !== 'undefined') {
                status += 'âœ… marked.js å·²åŠ è½½<br>';
            } else {
                status += 'âŒ marked.js æœªåŠ è½½<br>';
                allLoaded = false;
            }
            
            if (typeof hljs !== 'undefined') {
                status += 'âœ… highlight.js å·²åŠ è½½<br>';
            } else {
                status += 'âŒ highlight.js æœªåŠ è½½<br>';
                allLoaded = false;
            }
            
            if (typeof DOMPurify !== 'undefined') {
                status += 'âœ… DOMPurify å·²åŠ è½½<br>';
            } else {
                status += 'âŒ DOMPurify æœªåŠ è½½<br>';
                allLoaded = false;
            }
            
            status += '</div>';
            document.getElementById('status').innerHTML = status;
            
            if (allLoaded) {
                console.log('æ‰€æœ‰åº“å·²æˆåŠŸåŠ è½½');
                // é…ç½®marked
                marked.setOptions({
                    breaks: true,
                    gfm: true,
                    tables: true,
                    highlight: function(code, lang) {
                        if (lang && hljs.getLanguage(lang)) {
                            return hljs.highlight(code, { language: lang }).value;
                        }
                        return hljs.highlightAuto(code).value;
                    }
                });
            }
        });
        
        function render(markdown) {
            console.log('æ¸²æŸ“Markdown:', markdown.substring(0, 100));
            const output = document.getElementById('output');
            
            try {
                const rawHtml = marked.parse(markdown);
                console.log('ç”ŸæˆHTML:', rawHtml.substring(0, 100));
                
                const cleanHtml = DOMPurify.sanitize(rawHtml);
                output.innerHTML = cleanHtml;
                
                output.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
                
                console.log('âœ… æ¸²æŸ“æˆåŠŸ');
            } catch (error) {
                console.error('âŒ æ¸²æŸ“å¤±è´¥:', error);
                output.textContent = 'æ¸²æŸ“å¤±è´¥: ' + error.message;
            }
        }
        
        function testTable() {
            const markdown = `
## ğŸ“Š æµ‹è¯•è¡¨æ ¼

| åˆ—1 | åˆ—2 | åˆ—3 |
|-----|-----|-----|
| A   | B   | C   |
| D   | E   | F   |
| G   | H   | I   |
            `;
            render(markdown);
        }
        
        function testCode() {
            const markdown = `
## ğŸ’» æµ‹è¯•ä»£ç 

\`\`\`python
def hello():
    print("Hello, World!")
    return True
\`\`\`

è¡Œå†…ä»£ç ï¼š\`const x = 10;\`
            `;
            render(markdown);
        }
        
        function testMixed() {
            const markdown = `
# å®Œæ•´æµ‹è¯•

## è¡¨æ ¼
| åç§° | æ•°å€¼ |
|------|------|
| A    | 100  |
| B    | 200  |

## ä»£ç 
\`\`\`javascript
console.log('test');
\`\`\`

## åˆ—è¡¨
1. ç¬¬ä¸€é¡¹
2. ç¬¬äºŒé¡¹

**ç²—ä½“** å’Œ *æ–œä½“*
            `;
            render(markdown);
        }
    </script>
</body>
</html>
