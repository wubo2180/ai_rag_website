{% extends 'base.html' %}

{% block title %}个人资料 - {{ block.super }}{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; margin: 0 auto;">
    <div class="profile-header" style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
        <div style="display: flex; align-items: center; gap: 20px;">
            <div class="avatar" style="width: 80px; height: 80px; border-radius: 50%; background: #007bff; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                {{ user.username|first|upper }}
            </div>
            <div>
                <h1 style="margin: 0; color: #333;">{{ user.username }}</h1>
                <p style="color: #666; margin: 5px 0;">{{ user.email }}</p>
                <p style="color: #999; font-size: 14px;">加入时间: {{ user.date_joined|date:"Y年m月d日" }}</p>
            </div>
        </div>
    </div>

    <div class="profile-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
        <!-- 账户信息 -->
        <div class="account-info" style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 20px 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px;">账户信息</h3>
            
            <div class="info-item" style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                <label style="font-weight: bold; color: #555;">用户名:</label>
                <span style="margin-left: 10px;">{{ user.username }}</span>
            </div>
            
            <div class="info-item" style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                <label style="font-weight: bold; color: #555;">邮箱:</label>
                <span style="margin-left: 10px;">{{ user.email|default:"未设置" }}</span>
            </div>
            
            <div class="info-item" style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                <label style="font-weight: bold; color: #555;">姓名:</label>
                <span style="margin-left: 10px;">{{ user.first_name }} {{ user.last_name|default:"" }}</span>
            </div>
            
            <div class="info-item" style="margin-bottom: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                <label style="font-weight: bold; color: #555;">最后登录:</label>
                <span style="margin-left: 10px;">{{ user.last_login|date:"Y-m-d H:i"|default:"从未登录" }}</span>
            </div>
            
            <a href="{% url 'edit_profile' %}" class="btn btn-primary" style="width: 100%; text-align: center;">编辑资料</a>
        </div>

        <!-- 使用统计 -->
        <div class="usage-stats" style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 20px 0; color: #333; border-bottom: 2px solid #28a745; padding-bottom: 10px;">使用统计</h3>
            
            <div class="stat-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 10px; background: linear-gradient(135deg, #007bff, #6610f2); color: white; border-radius: 8px;">
                <div>
                    <div style="font-size: 24px; font-weight: bold;">{{ chat_sessions_count|default:0 }}</div>
                    <div style="font-size: 14px; opacity: 0.9;">对话会话</div>
                </div>
                <div style="font-size: 36px; opacity: 0.7;">💬</div>
            </div>
            
            <div class="stat-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 10px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 8px;">
                <div>
                    <div style="font-size: 24px; font-weight: bold;">{{ knowledge_count|default:0 }}</div>
                    <div style="font-size: 14px; opacity: 0.9;">知识条目</div>
                </div>
                <div style="font-size: 36px; opacity: 0.7;">📚</div>
            </div>
            
            <div class="stat-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 20px; background: linear-gradient(135deg, #ffc107, #fd7e14); color: white; border-radius: 8px;">
                <div>
                    <div style="font-size: 24px; font-weight: bold;">{{ documents_count|default:0 }}</div>
                    <div style="font-size: 14px; opacity: 0.9;">上传文档</div>
                </div>
                <div style="font-size: 36px; opacity: 0.7;">📄</div>
            </div>
            
            <a href="{% url 'change_password' %}" class="btn" style="width: 100%; text-align: center; background: #6c757d; color: white;">修改密码</a>
        </div>
    </div>

    <!-- 最近活动 -->
    <div class="recent-activity" style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 30px;">
        <h3 style="margin: 0 0 20px 0; color: #333; border-bottom: 2px solid #17a2b8; padding-bottom: 10px;">最近活动</h3>
        
        {% if recent_sessions %}
            <div class="activity-list">
                {% for session in recent_sessions %}
                <div class="activity-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 10px; background: #f8f9fa; border-radius: 5px; border-left: 4px solid #007bff;">
                    <div>
                        <div style="font-weight: bold; color: #333;">{{ session.title }}</div>
                        <div style="font-size: 12px; color: #666;">{{ session.messages.count }} 条消息</div>
                    </div>
                    <div style="font-size: 12px; color: #999;">{{ session.updated_at|date:"m-d H:i" }}</div>
                </div>
                {% endfor %}
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <a href="{% url 'chat_index' %}" class="btn btn-primary">查看所有对话</a>
            </div>
        {% else %}
            <div style="text-align: center; padding: 30px; color: #666;">
                <div style="font-size: 48px; margin-bottom: 10px;">🤔</div>
                <p>还没有任何活动记录</p>
                <a href="{% url 'chat_index' %}" class="btn btn-primary">开始第一次对话</a>
            </div>
        {% endif %}
    </div>
</div>

<style>
@media (max-width: 768px) {
    .profile-content {
        grid-template-columns: 1fr !important;
    }
    
    .profile-header div:first-child {
        flex-direction: column !important;
        text-align: center !important;
    }
}
</style>
{% endblock %}