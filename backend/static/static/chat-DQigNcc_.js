import{G as b,r as u,n as h,C as c}from"./index-Bn8zWV3R.js";const G=b("chat",()=>{const r=u([]),t=u(null),n=u([]),d=u(!1),v=u([]),f=u(""),p=h(()=>n.value.length>0),y=h(()=>r.value.length);async function m(){try{const e=await c.get("/chat/sessions/");return r.value=e.data.results||e.data,{success:!0,data:e.data}}catch(e){return console.error("获取会话列表失败:",e),{success:!1,error:"获取会话列表失败"}}}async function g(e=""){try{const o=(await c.post("/chat/sessions/",{title:e})).data;return r.value.unshift(o),{success:!0,data:o}}catch(s){return console.error("创建会话失败:",s),{success:!1,error:"创建会话失败"}}}async function _(e){try{const s=await c.get(`/chat/sessions/${e}/history/`);return n.value=s.data.messages||[],t.value={id:s.data.id,title:s.data.title,created_at:s.data.created_at,updated_at:s.data.updated_at},{success:!0,data:s.data}}catch(s){return console.error("获取会话历史失败:",s),{success:!1,error:"获取会话历史失败"}}}async function S(e,s=null,o=null){var l,i;d.value=!0;try{const a=await c.post("/chat/chat/",{message:e,session_id:s,model:o||f.value});return a.data.success?(a.data.user_message&&n.value.push(a.data.user_message),a.data.ai_message&&n.value.push(a.data.ai_message),a.data.session_id&&!t.value&&(t.value={id:a.data.session_id}),{success:!0,data:a.data,sessionId:a.data.session_id}):{success:!1,error:a.data.error||"发送消息失败"}}catch(a){return console.error("发送消息失败:",a),{success:!1,error:((i=(l=a.response)==null?void 0:l.data)==null?void 0:i.error)||"发送消息失败"}}finally{d.value=!1}}async function w(){try{const e=await c.get("/chat/models/");return v.value=e.data.models||[],f.value=e.data.default_model||"",{success:!0,data:e.data}}catch(e){return console.error("获取可用模型失败:",e),{success:!1,error:"获取可用模型失败"}}}async function C(e,s){try{const o=await c.post(`/chat/sessions/${e}/rename/`,{title:s}),l=r.value.findIndex(i=>i.id===e);return l!==-1&&(r.value[l].title=s),t.value&&t.value.id===e&&(t.value.title=s),{success:!0,data:o.data}}catch(o){return console.error("重命名会话失败:",o),{success:!1,error:"重命名会话失败"}}}async function M(e){try{return await c.delete(`/chat/sessions/${e}/`),r.value=r.value.filter(s=>s.id!==e),t.value&&t.value.id===e&&(t.value=null,n.value=[]),{success:!0}}catch(s){return console.error("删除会话失败:",s),{success:!1,error:"删除会话失败"}}}function x(){t.value=null,n.value=[]}function $(e){t.value=e,n.value=[]}return{sessions:r,currentSession:t,messages:n,isLoading:d,availableModels:v,selectedModel:f,hasMessages:p,sessionCount:y,fetchSessions:m,createSession:g,fetchSessionHistory:_,sendMessage:S,fetchAvailableModels:w,renameSession:C,deleteSession:M,clearCurrentSession:x,setCurrentSession:$}});export{G as u};
