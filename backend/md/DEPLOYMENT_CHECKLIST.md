# 生产部署检查清单

在将应用部署到生产环境之前，请逐项检查以下内容。

## 📋 部署前检查

### 服务器准备

- [ ] 服务器已购买并可访问
- [ ] 服务器满足最低配置要求（2核CPU, 4GB内存, 20GB存储）
- [ ] 已获取服务器 root 或 sudo 权限
- [ ] SSH 密钥已配置（推荐）或密码登录可用
- [ ] 服务器公网 IP 已记录

### 域名和 DNS

- [ ] 域名已购买
- [ ] DNS A 记录已添加指向服务器 IP
- [ ] DNS 解析已生效（ping 域名可以通）
- [ ] 计划使用的子域名都已配置

### 代码准备

- [ ] 代码已提交到 Git 仓库
- [ ] `.env` 文件已从 `.gitignore` 排除
- [ ] 所有功能已在本地测试通过
- [ ] 数据库迁移文件已生成并提交

### 环境变量配置

- [ ] `.env.production` 已复制为 `.env`
- [ ] `DEBUG=False` 已设置
- [ ] `SECRET_KEY` 已生成并替换
- [ ] `ALLOWED_HOSTS` 包含所有域名和 IP
- [ ] `DB_PASSWORD` 设置为强密码（16位+）
- [ ] `DIFY_API_KEY` 已配置
- [ ] `DIFY_BASE_URL` 已配置为正确地址

### 第三方服务

- [ ] Dify API 可正常访问
- [ ] Dify API 密钥有效
- [ ] 邮件服务已配置（如需要）
- [ ] 对象存储已配置（如需要）

---

## 🔧 部署中检查

### Docker 安装

- [ ] Docker 已安装并运行
- [ ] Docker Compose 已安装
- [ ] 当前用户已添加到 docker 组
- [ ] Docker 镜像加速已配置（国内）

### 应用部署

- [ ] 代码已克隆到服务器
- [ ] 权限已正确设置
- [ ] Docker 镜像构建成功
- [ ] 所有容器已启动
- [ ] 数据库迁移已执行
- [ ] 静态文件已收集
- [ ] 超级用户已创建

### 网络配置

- [ ] 防火墙已配置（80, 443, 22 端口）
- [ ] 端口转发正确（如使用云服务器安全组）
- [ ] Nginx 配置正确
- [ ] 可通过 IP 访问网站
- [ ] 可通过域名访问网站

---

## 🔐 安全检查

### 应用安全

- [ ] `DEBUG=False` 在生产环境
- [ ] `SECRET_KEY` 是随机生成的强密钥
- [ ] 数据库密码足够强（16位+，包含特殊字符）
- [ ] 默认管理员密码已修改
- [ ] CSRF 保护已启用
- [ ] XSS 保护已启用

### 服务器安全

- [ ] SSH 端口已修改（可选）
- [ ] 禁用 root 密码登录
- [ ] SSH 密钥登录已启用
- [ ] 防火墙已启用并配置
- [ ] fail2ban 已安装（可选）
- [ ] 定期更新计划已制定

### SSL/TLS

- [ ] SSL 证书已获取
- [ ] HTTPS 已启用
- [ ] HTTP 自动重定向到 HTTPS
- [ ] SSL 证书自动续期已配置
- [ ] HSTS 头已配置
- [ ] SSL 实验室评级 A+（可选）

---

## 📊 部署后验证

### 功能测试

- [ ] 网站首页可正常访问
- [ ] 用户注册功能正常
- [ ] 用户登录功能正常
- [ ] 聊天功能正常
- [ ] AI 回复功能正常
- [ ] 文件上传功能正常（如有）
- [ ] 管理后台可访问
- [ ] 所有页面样式正常

### 性能测试

- [ ] 页面加载时间 < 3秒
- [ ] API 响应时间 < 1秒
- [ ] 静态文件加载正常
- [ ] 无明显性能瓶颈
- [ ] 并发测试通过（可选）

### 错误检查

- [ ] 无 500 错误
- [ ] 无 404 错误（重要页面）
- [ ] 日志中无严重错误
- [ ] 浏览器控制台无 JS 错误

---

## 🛡️ 运维配置

### 备份

- [ ] 数据库自动备份已配置
- [ ] 备份脚本测试成功
- [ ] 备份计划已添加到 crontab
- [ ] 备份存储位置已确认
- [ ] 备份恢复已测试

### 监控

- [ ] 监控脚本已配置
- [ ] 健康检查已设置
- [ ] 告警邮箱已配置
- [ ] 日志轮转已配置
- [ ] 磁盘空间监控已设置

### 文档

- [ ] 部署文档已更新
- [ ] 环境变量已记录
- [ ] 管理员联系方式已记录
- [ ] 紧急处理流程已制定
- [ ] 团队成员已培训

---

## 📈 优化配置（可选）

### 性能优化

- [ ] Redis 缓存已启用
- [ ] 数据库连接池已配置
- [ ] Gunicorn workers 已优化
- [ ] CDN 已配置
- [ ] 图片压缩已启用

### 扩展性

- [ ] 负载均衡已配置（如需要）
- [ ] 数据库主从复制（如需要）
- [ ] 容器编排（K8s）（如需要）
- [ ] 微服务拆分计划（如需要）

### 监控和日志

- [ ] 集中日志系统（ELK）
- [ ] APM 工具（Sentry, New Relic）
- [ ] 性能监控（Prometheus）
- [ ] 可视化面板（Grafana）

---

## ✅ 上线确认

### 最终检查

- [ ] 所有上述检查项已完成
- [ ] 测试环境完整测试通过
- [ ] 灾难恢复计划已制定
- [ ] 回滚方案已准备
- [ ] 团队成员已通知
- [ ] 用户通知已发送（如需要）

### 上线后监控

- [ ] 持续监控服务状态 24 小时
- [ ] 检查错误日志
- [ ] 验证备份执行
- [ ] 收集用户反馈
- [ ] 性能指标跟踪

---

## 📞 紧急联系

**技术负责人**: _________________  
**运维负责人**: _________________  
**紧急电话**: _________________  
**备用方案**: _________________

---

## 📝 签名确认

| 角色 | 姓名 | 签名 | 日期 |
|-----|------|------|------|
| 开发负责人 | | | |
| 运维负责人 | | | |
| 项目经理 | | | |

---

## 🎉 恭喜！

完成所有检查项后，你的应用就可以安全地部署到生产环境了！

**记住**：
1. 保持冷静，按步骤操作
2. 做好备份，准备回滚
3. 持续监控，及时响应
4. 记录问题，持续改进

祝部署顺利！🚀
