[uwsgi]
# 生产环境配置
module = config.wsgi:application
master = true
processes = 8
threads = 4
max-requests = 5000
buffer-size = 32768

# 使用socket与nginx通信
socket = /tmp/uwsgi.sock
chmod-socket = 666
vacuum = true

# 项目路径
chdir = /www/wwwroot/ai_rag_website/backend
home = /www/server/pyporject_evn/versions/3.13.7
pythonpath = /www/wwwroot/ai_rag_website/backend

# 环境变量
env = DJANGO_SETTINGS_MODULE=config.settings
env = PYTHONPATH=/www/wwwroot/ai_rag_website/backend

# 日志配置
logto = /www/wwwroot/ai_rag_website/backend/logs/uwsgi.log
log-maxsize = 50000000
log-backupcount = 10
log-format = %(addr) - %(user) [%(ltime)] "%(method) %(uri) %(proto)" %(status) %(size) "%(referer)" "%(uagent)"

# 性能优化
vacuum = true
die-on-term = true
lazy-apps = true
single-interpreter = true
enable-threads = true
thunder-lock = true

# 静态文件
static-map = /static=/www/wwwroot/ai_rag_website/backend/staticfiles
static-map = /media=/www/wwwroot/ai_rag_website/backend/media

# 安全配置
uid = www-data
gid = www-data

# 进程管理
pidfile = /tmp/uwsgi.pid
harakiri = 300
harakiri-verbose = true
reload-mercy = 10
worker-reload-mercy = 10

# 内存管理
reload-on-as = 512
reload-on-rss = 256
no-orphans = true

# 监控
stats = /tmp/uwsgi-stats.sock
stats-http = true