import{_ as w,c as i,o as r,b as t,q as d,N as _,O as y,x as b,t as n,h as p,F as m,s as D,y as v,i as h,G as P}from"./index-Dw5cNvgt.js";const f={name:"KnowledgeBase",data(){return{datasets:[],totalDatasets:0,currentPage:1,pageSize:12,totalPages:0,searchKeyword:"",loading:!1,error:null,selectedDataset:null,showDocuments:!1,currentDatasetId:null,currentDatasetName:"",documents:[],totalDocuments:0,currentDocPage:1,docPageSize:20,totalDocPages:0,docSearchKeyword:"",documentsLoading:!1}},computed:{visiblePages(){const o=[],s=Math.max(1,this.currentPage-2),c=Math.min(this.totalPages,this.currentPage+2);for(let u=s;u<=c;u++)o.push(u);return o}},mounted(){console.log("ðŸ§  çŸ¥è¯†åº“ç®¡ç†é¡µé¢å¼€å§‹åŠ è½½..."),console.log("å½“å‰è·¯ç”±:",this.$route),this.loadDatasets()},methods:{async loadDatasets(){this.loading=!0,this.error=null;try{const o={page:this.currentPage,limit:this.pageSize};this.searchKeyword.trim()&&(o.keyword=this.searchKeyword.trim()),console.log("ðŸ” æ­£åœ¨åŠ è½½çŸ¥è¯†åº“åˆ—è¡¨...",o);const s=await P.get("knowledge/dify/datasets/",{params:o});if(s.data.success){const c=s.data.data;this.datasets=c.data||[],this.totalDatasets=c.total||0,this.totalPages=Math.ceil(this.totalDatasets/this.pageSize),console.log(`âœ… æˆåŠŸåŠ è½½ ${this.datasets.length} ä¸ªçŸ¥è¯†åº“`)}else this.error=s.data.error||"åŠ è½½çŸ¥è¯†åº“å¤±è´¥"}catch(o){console.error("âŒ åŠ è½½çŸ¥è¯†åº“å¤±è´¥:",o),this.error="ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿žæŽ¥åŽé‡è¯•"}finally{this.loading=!1}},async searchDatasets(){this.currentPage=1,await this.loadDatasets()},async refreshDatasets(){this.searchKeyword="",this.currentPage=1,await this.loadDatasets()},async changePage(o){o>=1&&o<=this.totalPages&&(this.currentPage=o,await this.loadDatasets())},viewDatasetDetail(o){this.selectedDataset=o,console.log("ðŸ“š æŸ¥çœ‹çŸ¥è¯†åº“è¯¦æƒ…:",o.name)},closeDetail(){this.selectedDataset=null},async viewDocuments(o){this.currentDatasetId=o.id,this.currentDatasetName=o.name,this.showDocuments=!0,this.closeDetail(),await this.loadDocuments()},closeDocuments(){this.showDocuments=!1,this.currentDatasetId=null,this.currentDatasetName="",this.documents=[],this.docSearchKeyword="",this.currentDocPage=1},async loadDocuments(){if(this.currentDatasetId){this.documentsLoading=!0;try{const o={page:this.currentDocPage,limit:this.docPageSize};this.docSearchKeyword.trim()&&(o.keyword=this.docSearchKeyword.trim()),console.log("ðŸ“„ æ­£åœ¨åŠ è½½æ–‡æ¡£åˆ—è¡¨...",o);const s=await P.get(`knowledge/dify/datasets/${this.currentDatasetId}/documents/`,{params:o});if(s.data.success){const c=s.data.data;this.documents=c.data||[],this.totalDocuments=c.total||0,this.totalDocPages=Math.ceil(this.totalDocuments/this.docPageSize),console.log(`âœ… æˆåŠŸåŠ è½½ ${this.documents.length} ä¸ªæ–‡æ¡£`)}else console.error("âŒ åŠ è½½æ–‡æ¡£å¤±è´¥:",s.data.error)}catch(o){console.error("âŒ åŠ è½½æ–‡æ¡£å¤±è´¥:",o)}finally{this.documentsLoading=!1}}},async searchDocuments(){this.currentDocPage=1,await this.loadDocuments()},async changeDocPage(o){o>=1&&o<=this.totalDocPages&&(this.currentDocPage=o,await this.loadDocuments())},getStatusClass(o){const s=o.status||"å¯ç”¨";return{"status-available":s==="å¯ç”¨","status-processing":s==="å¤„ç†ä¸­","status-error":s.includes("é”™è¯¯")}},getDataSourceText(o){return{upload_file:"ä¸Šä¼ æ–‡ä»¶",notion_import:"Notionå¯¼å…¥",web_crawl:"ç½‘é¡µçˆ¬å–",api:"APIæŽ¥å…¥"}[o]||o||"æœªçŸ¥"},getDocumentStatus(o){return{completed:"å·²å®Œæˆ",processing:"å¤„ç†ä¸­",error:"é”™è¯¯",waiting:"ç­‰å¾…ä¸­"}[o]||o||"æœªçŸ¥"},formatFileSize(o){if(!o)return"0 B";const s=1024,c=["B","KB","MB","GB"],u=Math.floor(Math.log(o)/Math.log(s));return parseFloat((o/Math.pow(s,u)).toFixed(2))+" "+c[u]},formatTime(o){if(!o)return"æœªçŸ¥";try{return new Date(o*1e3).toLocaleString("zh-CN")}catch{return"æœªçŸ¥"}}}},k={class:"knowledge-base-container"},C={class:"search-section"},S={class:"search-controls"},K={class:"search-input-group"},x=["disabled"],z={key:0,class:"loading-section"},M={key:1,class:"error-section"},B={class:"error-message"},N={key:2,class:"datasets-section"},I={class:"stats-bar"},L={class:"stats-text"},T={class:"datasets-grid"},F=["onClick"],V={class:"dataset-header"},G={class:"dataset-content"},U={class:"dataset-name"},q={class:"dataset-description"},A={class:"dataset-meta"},E={class:"meta-item"},O={class:"meta-value"},j={class:"meta-item"},H={class:"meta-value"},J={class:"meta-item"},Q={class:"meta-value"},R={class:"dataset-actions"},W=["onClick"],X=["onClick"],Y={key:0,class:"pagination-section"},Z={class:"pagination-controls"},$=["disabled"],ss={class:"page-numbers"},ts=["onClick"],es=["disabled"],as={class:"pagination-info"},os={class:"modal-header"},ls={class:"modal-body"},ns={class:"detail-section"},is={class:"detail-grid"},rs={class:"detail-item"},cs={class:"detail-item"},ds={class:"detail-item"},us={class:"detail-item"},hs={class:"detail-item"},gs={class:"detail-item"},ms={class:"detail-actions"},Ds={class:"modal-header"},vs={class:"modal-body"},_s={class:"doc-search"},ys={key:0,class:"loading-section"},bs={key:1,class:"documents-list"},ps={class:"doc-info"},Ps={class:"doc-name"},ws={class:"doc-meta"},fs={class:"doc-time"},ks={key:0,class:"empty-state"},Cs={key:2,class:"pagination-section"},Ss={class:"pagination-controls"},Ks=["disabled"],xs={class:"page-info"},zs=["disabled"];function Ms(o,s,c,u,a,l){return r(),i("div",k,[s[36]||(s[36]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},"ðŸ§  çŸ¥è¯†åº“ç®¡ç†"),t("p",{class:"page-subtitle"},"ç®¡ç†å’Œæµè§ˆDifyçŸ¥è¯†åº“ä¸­çš„æ•°æ®é›†å’Œæ–‡æ¡£")],-1)),t("div",C,[t("div",S,[t("div",K,[_(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>a.searchKeyword=e),onKeyup:s[1]||(s[1]=b((...e)=>l.searchDatasets&&l.searchDatasets(...e),["enter"])),type:"text",class:"search-input",placeholder:"æœç´¢çŸ¥è¯†åº“åç§°..."},null,544),[[y,a.searchKeyword]]),t("button",{onClick:s[2]||(s[2]=(...e)=>l.searchDatasets&&l.searchDatasets(...e)),class:"search-btn"}," ðŸ” æœç´¢ ")]),t("button",{onClick:s[3]||(s[3]=(...e)=>l.refreshDatasets&&l.refreshDatasets(...e)),class:"refresh-btn",disabled:a.loading}," ðŸ”„ åˆ·æ–° ",8,x)])]),a.loading?(r(),i("div",z,[...s[19]||(s[19]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"æ­£åœ¨åŠ è½½çŸ¥è¯†åº“åˆ—è¡¨...",-1)])])):d("",!0),a.error?(r(),i("div",M,[t("div",B," âŒ "+n(a.error),1),t("button",{onClick:s[4]||(s[4]=(...e)=>l.refreshDatasets&&l.refreshDatasets(...e)),class:"retry-btn"},"é‡è¯•")])):d("",!0),!a.loading&&!a.error?(r(),i("div",N,[t("div",I,[t("span",L,[s[20]||(s[20]=p(" å…±æ‰¾åˆ° ",-1)),t("strong",null,n(a.totalDatasets),1),s[21]||(s[21]=p(" ä¸ªçŸ¥è¯†åº“ ",-1))])]),t("div",T,[(r(!0),i(m,null,D(a.datasets,e=>(r(),i("div",{key:e.id,class:"dataset-card",onClick:g=>l.viewDatasetDetail(e)},[t("div",V,[s[22]||(s[22]=t("div",{class:"dataset-icon"},"ðŸ“š",-1)),t("div",{class:v(["dataset-status",l.getStatusClass(e)])},n(e.status||"å¯ç”¨"),3)]),t("div",G,[t("h3",U,n(e.name),1),t("p",q,n(e.description||"æš‚æ— æè¿°"),1),t("div",A,[t("div",E,[s[23]||(s[23]=t("span",{class:"meta-label"},"æ–‡æ¡£æ•°:",-1)),t("span",O,n(e.document_count||0),1)]),t("div",j,[s[24]||(s[24]=t("span",{class:"meta-label"},"åˆ›å»ºæ—¶é—´:",-1)),t("span",H,n(e.created_at_readable||"æœªçŸ¥"),1)]),t("div",J,[s[25]||(s[25]=t("span",{class:"meta-label"},"æ•°æ®æº:",-1)),t("span",Q,n(l.getDataSourceText(e.data_source_type)),1)])])]),t("div",R,[t("button",{onClick:h(g=>l.viewDocuments(e),["stop"]),class:"action-btn view-docs"}," ðŸ“„ æŸ¥çœ‹æ–‡æ¡£ ",8,W),t("button",{onClick:h(g=>l.viewDatasetDetail(e),["stop"]),class:"action-btn view-detail"}," â„¹ï¸ è¯¦æƒ… ",8,X)])],8,F))),128))]),a.totalPages>1?(r(),i("div",Y,[t("div",Z,[t("button",{onClick:s[5]||(s[5]=e=>l.changePage(a.currentPage-1)),disabled:a.currentPage<=1,class:"page-btn"}," â† ä¸Šä¸€é¡µ ",8,$),t("div",ss,[(r(!0),i(m,null,D(l.visiblePages,e=>(r(),i("span",{key:e,onClick:g=>l.changePage(e),class:v(["page-number",{active:e===a.currentPage}])},n(e),11,ts))),128))]),t("button",{onClick:s[6]||(s[6]=e=>l.changePage(a.currentPage+1)),disabled:a.currentPage>=a.totalPages,class:"page-btn"}," ä¸‹ä¸€é¡µ â†’ ",8,es)]),t("div",as," ç¬¬ "+n(a.currentPage)+" é¡µï¼Œå…± "+n(a.totalPages)+" é¡µ ",1)])):d("",!0)])):d("",!0),a.selectedDataset?(r(),i("div",{key:3,class:"modal-overlay",onClick:s[10]||(s[10]=(...e)=>l.closeDetail&&l.closeDetail(...e))},[t("div",{class:"modal-content",onClick:s[9]||(s[9]=h(()=>{},["stop"]))},[t("div",os,[t("h2",null,"ðŸ“š "+n(a.selectedDataset.name),1),t("button",{onClick:s[7]||(s[7]=(...e)=>l.closeDetail&&l.closeDetail(...e)),class:"close-btn"},"Ã—")]),t("div",ls,[t("div",ns,[s[32]||(s[32]=t("h3",null,"åŸºæœ¬ä¿¡æ¯",-1)),t("div",is,[t("div",rs,[s[26]||(s[26]=t("label",null,"åç§°:",-1)),t("span",null,n(a.selectedDataset.name),1)]),t("div",cs,[s[27]||(s[27]=t("label",null,"æè¿°:",-1)),t("span",null,n(a.selectedDataset.description||"æš‚æ— æè¿°"),1)]),t("div",ds,[s[28]||(s[28]=t("label",null,"æ–‡æ¡£æ•°é‡:",-1)),t("span",null,n(a.selectedDataset.document_count||0),1)]),t("div",us,[s[29]||(s[29]=t("label",null,"çŠ¶æ€:",-1)),t("span",{class:v(l.getStatusClass(a.selectedDataset))},n(a.selectedDataset.status||"å¯ç”¨"),3)]),t("div",hs,[s[30]||(s[30]=t("label",null,"æ•°æ®æºç±»åž‹:",-1)),t("span",null,n(l.getDataSourceText(a.selectedDataset.data_source_type)),1)]),t("div",gs,[s[31]||(s[31]=t("label",null,"åˆ›å»ºæ—¶é—´:",-1)),t("span",null,n(a.selectedDataset.created_at_readable||"æœªçŸ¥"),1)])])]),t("div",ms,[t("button",{onClick:s[8]||(s[8]=e=>l.viewDocuments(a.selectedDataset)),class:"detail-action-btn"}," ðŸ“„ æŸ¥çœ‹æ–‡æ¡£åˆ—è¡¨ ")])])])])):d("",!0),a.showDocuments?(r(),i("div",{key:4,class:"modal-overlay",onClick:s[18]||(s[18]=(...e)=>l.closeDocuments&&l.closeDocuments(...e))},[t("div",{class:"modal-content large",onClick:s[17]||(s[17]=h(()=>{},["stop"]))},[t("div",Ds,[t("h2",null,"ðŸ“„ æ–‡æ¡£åˆ—è¡¨ - "+n(a.currentDatasetName),1),t("button",{onClick:s[11]||(s[11]=(...e)=>l.closeDocuments&&l.closeDocuments(...e)),class:"close-btn"},"Ã—")]),t("div",vs,[t("div",_s,[_(t("input",{"onUpdate:modelValue":s[12]||(s[12]=e=>a.docSearchKeyword=e),onKeyup:s[13]||(s[13]=b((...e)=>l.searchDocuments&&l.searchDocuments(...e),["enter"])),type:"text",class:"search-input",placeholder:"æœç´¢æ–‡æ¡£..."},null,544),[[y,a.docSearchKeyword]]),t("button",{onClick:s[14]||(s[14]=(...e)=>l.searchDocuments&&l.searchDocuments(...e)),class:"search-btn"},"ðŸ”")]),a.documentsLoading?(r(),i("div",ys,[...s[33]||(s[33]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"æ­£åœ¨åŠ è½½æ–‡æ¡£åˆ—è¡¨...",-1)])])):d("",!0),a.documentsLoading?d("",!0):(r(),i("div",bs,[(r(!0),i(m,null,D(a.documents,e=>(r(),i("div",{key:e.id,class:"document-item"},[s[34]||(s[34]=t("div",{class:"doc-icon"},"ðŸ“„",-1)),t("div",ps,[t("h4",Ps,n(e.name),1),t("p",ws," å¤§å°: "+n(l.formatFileSize(e.file_size))+" | ç±»åž‹: "+n(e.file_type||"æœªçŸ¥")+" | çŠ¶æ€: "+n(l.getDocumentStatus(e.status)),1),t("p",fs," åˆ›å»ºæ—¶é—´: "+n(l.formatTime(e.created_at)),1)])]))),128)),a.documents.length===0?(r(),i("div",ks,[...s[35]||(s[35]=[t("p",null,"æš‚æ— æ–‡æ¡£",-1)])])):d("",!0)])),a.totalDocPages>1?(r(),i("div",Cs,[t("div",Ss,[t("button",{onClick:s[15]||(s[15]=e=>l.changeDocPage(a.currentDocPage-1)),disabled:a.currentDocPage<=1,class:"page-btn"}," â† ä¸Šä¸€é¡µ ",8,Ks),t("span",xs," ç¬¬ "+n(a.currentDocPage)+" é¡µï¼Œå…± "+n(a.totalDocPages)+" é¡µ ",1),t("button",{onClick:s[16]||(s[16]=e=>l.changeDocPage(a.currentDocPage+1)),disabled:a.currentDocPage>=a.totalDocPages,class:"page-btn"}," ä¸‹ä¸€é¡µ â†’ ",8,zs)])])):d("",!0)])])])):d("",!0)])}const Ns=w(f,[["render",Ms],["__scopeId","data-v-4991e973"]]);export{Ns as default};
