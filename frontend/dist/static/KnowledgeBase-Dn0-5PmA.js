import{_ as w,c as i,o as r,b as t,q as d,N as _,O as y,x as b,t as n,h as p,F as m,s as D,y as v,i as h,G as P}from"./index-Dw5cNvgt.js";const f={name:"KnowledgeBase",data(){return{datasets:[],totalDatasets:0,currentPage:1,pageSize:12,totalPages:0,searchKeyword:"",loading:!1,error:null,selectedDataset:null,showDocuments:!1,currentDatasetId:null,currentDatasetName:"",documents:[],totalDocuments:0,currentDocPage:1,docPageSize:20,totalDocPages:0,docSearchKeyword:"",documentsLoading:!1}},computed:{visiblePages(){const o=[],s=Math.max(1,this.currentPage-2),c=Math.min(this.totalPages,this.currentPage+2);for(let u=s;u<=c;u++)o.push(u);return o}},mounted(){console.log("🧠 知识库管理页面开始加载..."),console.log("当前路由:",this.$route),this.loadDatasets()},methods:{async loadDatasets(){this.loading=!0,this.error=null;try{const o={page:this.currentPage,limit:this.pageSize};this.searchKeyword.trim()&&(o.keyword=this.searchKeyword.trim()),console.log("🔍 正在加载知识库列表...",o);const s=await P.get("knowledge/dify/datasets/",{params:o});if(s.data.success){const c=s.data.data;this.datasets=c.data||[],this.totalDatasets=c.total||0,this.totalPages=Math.ceil(this.totalDatasets/this.pageSize),console.log(`✅ 成功加载 ${this.datasets.length} 个知识库`)}else this.error=s.data.error||"加载知识库失败"}catch(o){console.error("❌ 加载知识库失败:",o),this.error="网络错误，请检查连接后重试"}finally{this.loading=!1}},async searchDatasets(){this.currentPage=1,await this.loadDatasets()},async refreshDatasets(){this.searchKeyword="",this.currentPage=1,await this.loadDatasets()},async changePage(o){o>=1&&o<=this.totalPages&&(this.currentPage=o,await this.loadDatasets())},viewDatasetDetail(o){this.selectedDataset=o,console.log("📚 查看知识库详情:",o.name)},closeDetail(){this.selectedDataset=null},async viewDocuments(o){this.currentDatasetId=o.id,this.currentDatasetName=o.name,this.showDocuments=!0,this.closeDetail(),await this.loadDocuments()},closeDocuments(){this.showDocuments=!1,this.currentDatasetId=null,this.currentDatasetName="",this.documents=[],this.docSearchKeyword="",this.currentDocPage=1},async loadDocuments(){if(this.currentDatasetId){this.documentsLoading=!0;try{const o={page:this.currentDocPage,limit:this.docPageSize};this.docSearchKeyword.trim()&&(o.keyword=this.docSearchKeyword.trim()),console.log("📄 正在加载文档列表...",o);const s=await P.get(`knowledge/dify/datasets/${this.currentDatasetId}/documents/`,{params:o});if(s.data.success){const c=s.data.data;this.documents=c.data||[],this.totalDocuments=c.total||0,this.totalDocPages=Math.ceil(this.totalDocuments/this.docPageSize),console.log(`✅ 成功加载 ${this.documents.length} 个文档`)}else console.error("❌ 加载文档失败:",s.data.error)}catch(o){console.error("❌ 加载文档失败:",o)}finally{this.documentsLoading=!1}}},async searchDocuments(){this.currentDocPage=1,await this.loadDocuments()},async changeDocPage(o){o>=1&&o<=this.totalDocPages&&(this.currentDocPage=o,await this.loadDocuments())},getStatusClass(o){const s=o.status||"可用";return{"status-available":s==="可用","status-processing":s==="处理中","status-error":s.includes("错误")}},getDataSourceText(o){return{upload_file:"上传文件",notion_import:"Notion导入",web_crawl:"网页爬取",api:"API接入"}[o]||o||"未知"},getDocumentStatus(o){return{completed:"已完成",processing:"处理中",error:"错误",waiting:"等待中"}[o]||o||"未知"},formatFileSize(o){if(!o)return"0 B";const s=1024,c=["B","KB","MB","GB"],u=Math.floor(Math.log(o)/Math.log(s));return parseFloat((o/Math.pow(s,u)).toFixed(2))+" "+c[u]},formatTime(o){if(!o)return"未知";try{return new Date(o*1e3).toLocaleString("zh-CN")}catch{return"未知"}}}},k={class:"knowledge-base-container"},C={class:"search-section"},S={class:"search-controls"},K={class:"search-input-group"},x=["disabled"],z={key:0,class:"loading-section"},M={key:1,class:"error-section"},B={class:"error-message"},N={key:2,class:"datasets-section"},I={class:"stats-bar"},L={class:"stats-text"},T={class:"datasets-grid"},F=["onClick"],V={class:"dataset-header"},G={class:"dataset-content"},U={class:"dataset-name"},q={class:"dataset-description"},A={class:"dataset-meta"},E={class:"meta-item"},O={class:"meta-value"},j={class:"meta-item"},H={class:"meta-value"},J={class:"meta-item"},Q={class:"meta-value"},R={class:"dataset-actions"},W=["onClick"],X=["onClick"],Y={key:0,class:"pagination-section"},Z={class:"pagination-controls"},$=["disabled"],ss={class:"page-numbers"},ts=["onClick"],es=["disabled"],as={class:"pagination-info"},os={class:"modal-header"},ls={class:"modal-body"},ns={class:"detail-section"},is={class:"detail-grid"},rs={class:"detail-item"},cs={class:"detail-item"},ds={class:"detail-item"},us={class:"detail-item"},hs={class:"detail-item"},gs={class:"detail-item"},ms={class:"detail-actions"},Ds={class:"modal-header"},vs={class:"modal-body"},_s={class:"doc-search"},ys={key:0,class:"loading-section"},bs={key:1,class:"documents-list"},ps={class:"doc-info"},Ps={class:"doc-name"},ws={class:"doc-meta"},fs={class:"doc-time"},ks={key:0,class:"empty-state"},Cs={key:2,class:"pagination-section"},Ss={class:"pagination-controls"},Ks=["disabled"],xs={class:"page-info"},zs=["disabled"];function Ms(o,s,c,u,a,l){return r(),i("div",k,[s[36]||(s[36]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},"🧠 知识库管理"),t("p",{class:"page-subtitle"},"管理和浏览Dify知识库中的数据集和文档")],-1)),t("div",C,[t("div",S,[t("div",K,[_(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>a.searchKeyword=e),onKeyup:s[1]||(s[1]=b((...e)=>l.searchDatasets&&l.searchDatasets(...e),["enter"])),type:"text",class:"search-input",placeholder:"搜索知识库名称..."},null,544),[[y,a.searchKeyword]]),t("button",{onClick:s[2]||(s[2]=(...e)=>l.searchDatasets&&l.searchDatasets(...e)),class:"search-btn"}," 🔍 搜索 ")]),t("button",{onClick:s[3]||(s[3]=(...e)=>l.refreshDatasets&&l.refreshDatasets(...e)),class:"refresh-btn",disabled:a.loading}," 🔄 刷新 ",8,x)])]),a.loading?(r(),i("div",z,[...s[19]||(s[19]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"正在加载知识库列表...",-1)])])):d("",!0),a.error?(r(),i("div",M,[t("div",B," ❌ "+n(a.error),1),t("button",{onClick:s[4]||(s[4]=(...e)=>l.refreshDatasets&&l.refreshDatasets(...e)),class:"retry-btn"},"重试")])):d("",!0),!a.loading&&!a.error?(r(),i("div",N,[t("div",I,[t("span",L,[s[20]||(s[20]=p(" 共找到 ",-1)),t("strong",null,n(a.totalDatasets),1),s[21]||(s[21]=p(" 个知识库 ",-1))])]),t("div",T,[(r(!0),i(m,null,D(a.datasets,e=>(r(),i("div",{key:e.id,class:"dataset-card",onClick:g=>l.viewDatasetDetail(e)},[t("div",V,[s[22]||(s[22]=t("div",{class:"dataset-icon"},"📚",-1)),t("div",{class:v(["dataset-status",l.getStatusClass(e)])},n(e.status||"可用"),3)]),t("div",G,[t("h3",U,n(e.name),1),t("p",q,n(e.description||"暂无描述"),1),t("div",A,[t("div",E,[s[23]||(s[23]=t("span",{class:"meta-label"},"文档数:",-1)),t("span",O,n(e.document_count||0),1)]),t("div",j,[s[24]||(s[24]=t("span",{class:"meta-label"},"创建时间:",-1)),t("span",H,n(e.created_at_readable||"未知"),1)]),t("div",J,[s[25]||(s[25]=t("span",{class:"meta-label"},"数据源:",-1)),t("span",Q,n(l.getDataSourceText(e.data_source_type)),1)])])]),t("div",R,[t("button",{onClick:h(g=>l.viewDocuments(e),["stop"]),class:"action-btn view-docs"}," 📄 查看文档 ",8,W),t("button",{onClick:h(g=>l.viewDatasetDetail(e),["stop"]),class:"action-btn view-detail"}," ℹ️ 详情 ",8,X)])],8,F))),128))]),a.totalPages>1?(r(),i("div",Y,[t("div",Z,[t("button",{onClick:s[5]||(s[5]=e=>l.changePage(a.currentPage-1)),disabled:a.currentPage<=1,class:"page-btn"}," ← 上一页 ",8,$),t("div",ss,[(r(!0),i(m,null,D(l.visiblePages,e=>(r(),i("span",{key:e,onClick:g=>l.changePage(e),class:v(["page-number",{active:e===a.currentPage}])},n(e),11,ts))),128))]),t("button",{onClick:s[6]||(s[6]=e=>l.changePage(a.currentPage+1)),disabled:a.currentPage>=a.totalPages,class:"page-btn"}," 下一页 → ",8,es)]),t("div",as," 第 "+n(a.currentPage)+" 页，共 "+n(a.totalPages)+" 页 ",1)])):d("",!0)])):d("",!0),a.selectedDataset?(r(),i("div",{key:3,class:"modal-overlay",onClick:s[10]||(s[10]=(...e)=>l.closeDetail&&l.closeDetail(...e))},[t("div",{class:"modal-content",onClick:s[9]||(s[9]=h(()=>{},["stop"]))},[t("div",os,[t("h2",null,"📚 "+n(a.selectedDataset.name),1),t("button",{onClick:s[7]||(s[7]=(...e)=>l.closeDetail&&l.closeDetail(...e)),class:"close-btn"},"×")]),t("div",ls,[t("div",ns,[s[32]||(s[32]=t("h3",null,"基本信息",-1)),t("div",is,[t("div",rs,[s[26]||(s[26]=t("label",null,"名称:",-1)),t("span",null,n(a.selectedDataset.name),1)]),t("div",cs,[s[27]||(s[27]=t("label",null,"描述:",-1)),t("span",null,n(a.selectedDataset.description||"暂无描述"),1)]),t("div",ds,[s[28]||(s[28]=t("label",null,"文档数量:",-1)),t("span",null,n(a.selectedDataset.document_count||0),1)]),t("div",us,[s[29]||(s[29]=t("label",null,"状态:",-1)),t("span",{class:v(l.getStatusClass(a.selectedDataset))},n(a.selectedDataset.status||"可用"),3)]),t("div",hs,[s[30]||(s[30]=t("label",null,"数据源类型:",-1)),t("span",null,n(l.getDataSourceText(a.selectedDataset.data_source_type)),1)]),t("div",gs,[s[31]||(s[31]=t("label",null,"创建时间:",-1)),t("span",null,n(a.selectedDataset.created_at_readable||"未知"),1)])])]),t("div",ms,[t("button",{onClick:s[8]||(s[8]=e=>l.viewDocuments(a.selectedDataset)),class:"detail-action-btn"}," 📄 查看文档列表 ")])])])])):d("",!0),a.showDocuments?(r(),i("div",{key:4,class:"modal-overlay",onClick:s[18]||(s[18]=(...e)=>l.closeDocuments&&l.closeDocuments(...e))},[t("div",{class:"modal-content large",onClick:s[17]||(s[17]=h(()=>{},["stop"]))},[t("div",Ds,[t("h2",null,"📄 文档列表 - "+n(a.currentDatasetName),1),t("button",{onClick:s[11]||(s[11]=(...e)=>l.closeDocuments&&l.closeDocuments(...e)),class:"close-btn"},"×")]),t("div",vs,[t("div",_s,[_(t("input",{"onUpdate:modelValue":s[12]||(s[12]=e=>a.docSearchKeyword=e),onKeyup:s[13]||(s[13]=b((...e)=>l.searchDocuments&&l.searchDocuments(...e),["enter"])),type:"text",class:"search-input",placeholder:"搜索文档..."},null,544),[[y,a.docSearchKeyword]]),t("button",{onClick:s[14]||(s[14]=(...e)=>l.searchDocuments&&l.searchDocuments(...e)),class:"search-btn"},"🔍")]),a.documentsLoading?(r(),i("div",ys,[...s[33]||(s[33]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"正在加载文档列表...",-1)])])):d("",!0),a.documentsLoading?d("",!0):(r(),i("div",bs,[(r(!0),i(m,null,D(a.documents,e=>(r(),i("div",{key:e.id,class:"document-item"},[s[34]||(s[34]=t("div",{class:"doc-icon"},"📄",-1)),t("div",ps,[t("h4",Ps,n(e.name),1),t("p",ws," 大小: "+n(l.formatFileSize(e.file_size))+" | 类型: "+n(e.file_type||"未知")+" | 状态: "+n(l.getDocumentStatus(e.status)),1),t("p",fs," 创建时间: "+n(l.formatTime(e.created_at)),1)])]))),128)),a.documents.length===0?(r(),i("div",ks,[...s[35]||(s[35]=[t("p",null,"暂无文档",-1)])])):d("",!0)])),a.totalDocPages>1?(r(),i("div",Cs,[t("div",Ss,[t("button",{onClick:s[15]||(s[15]=e=>l.changeDocPage(a.currentDocPage-1)),disabled:a.currentDocPage<=1,class:"page-btn"}," ← 上一页 ",8,Ks),t("span",xs," 第 "+n(a.currentDocPage)+" 页，共 "+n(a.totalDocPages)+" 页 ",1),t("button",{onClick:s[16]||(s[16]=e=>l.changeDocPage(a.currentDocPage+1)),disabled:a.currentDocPage>=a.totalDocPages,class:"page-btn"}," 下一页 → ",8,zs)])])):d("",!0)])])])):d("",!0)])}const Ns=w(f,[["render",Ms],["__scopeId","data-v-4991e973"]]);export{Ns as default};
