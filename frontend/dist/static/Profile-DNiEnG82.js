import{_ as B,u as F,r as w,a as P,p as M,c as N,o as q,b as m,d as o,w as s,h as V,e as p,E as f,G as y,j as L}from"./index-Dw5cNvgt.js";const S={class:"profile-container"},$={class:"profile-card"},j={class:"profile-header"},A={class:"password-section"},G={__name:"Profile",setup(T){L();const k=F(),c=w(),b=w(),g=w(!1),_=w(!1),i=P({username:"",email:""}),u=P({nickname:"",bio:""}),a=P({currentPassword:"",newPassword:"",confirmPassword:""}),U=(l,e,n)=>{e===""?n(new Error("请再次输入新密码")):e!==a.newPassword?n(new Error("两次输入密码不一致")):n()},x={nickname:[{max:50,message:"昵称长度不能超过50个字符",trigger:"blur"}],bio:[{max:200,message:"个人简介不能超过200个字符",trigger:"blur"}]},C={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{validator:U,trigger:"blur"}]},R=async()=>{try{const l=await k.fetchUserInfo();if(l.success){const e=l.data;i.username=e.user.username,i.email=e.user.email,e.profile&&(u.nickname=e.profile.nickname||"",u.bio=e.profile.bio||"")}}catch(l){console.error("获取用户信息失败:",l),f.error("获取用户信息失败")}},E=async()=>{if(c.value)try{await c.value.validate(),g.value=!0;const l=await y.put("/auth/profile/",{nickname:u.nickname,bio:u.bio});f.success("资料更新成功")}catch(l){console.error("更新资料失败:",l),f.error("更新资料失败")}finally{g.value=!1}},I=async()=>{var l,e;if(b.value)try{await b.value.validate(),_.value=!0;const n=await y.post("/auth/change-password/",{current_password:a.currentPassword,new_password:a.newPassword});f.success("密码修改成功"),a.currentPassword="",a.newPassword="",a.confirmPassword=""}catch(n){console.error("修改密码失败:",n);const t=((e=(l=n.response)==null?void 0:l.data)==null?void 0:e.error)||"修改密码失败";f.error(t)}finally{_.value=!1}};return M(()=>{R()}),(l,e)=>{const n=p("el-button"),t=p("el-input"),d=p("el-form-item"),v=p("el-form"),h=p("el-divider");return q(),N("div",S,[m("div",$,[m("div",j,[e[9]||(e[9]=m("h2",null,"个人资料",-1)),o(n,{onClick:e[0]||(e[0]=r=>l.$router.go(-1)),icon:"ArrowLeft"},{default:s(()=>[...e[8]||(e[8]=[V("返回",-1)])]),_:1})]),o(v,{model:i,rules:x,ref_key:"formRef",ref:c,"label-width":"100px"},{default:s(()=>[o(d,{label:"用户名",prop:"username"},{default:s(()=>[o(t,{modelValue:i.username,"onUpdate:modelValue":e[1]||(e[1]=r=>i.username=r),disabled:""},null,8,["modelValue"])]),_:1}),o(d,{label:"邮箱",prop:"email"},{default:s(()=>[o(t,{modelValue:i.email,"onUpdate:modelValue":e[2]||(e[2]=r=>i.email=r),disabled:""},null,8,["modelValue"])]),_:1}),o(d,{label:"昵称",prop:"nickname"},{default:s(()=>[o(t,{modelValue:u.nickname,"onUpdate:modelValue":e[3]||(e[3]=r=>u.nickname=r),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),o(d,{label:"个人简介",prop:"bio"},{default:s(()=>[o(t,{modelValue:u.bio,"onUpdate:modelValue":e[4]||(e[4]=r=>u.bio=r),type:"textarea",rows:4,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[o(n,{type:"primary",onClick:E,loading:g.value},{default:s(()=>[...e[10]||(e[10]=[V(" 保存资料 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),o(h),m("div",A,[e[12]||(e[12]=m("h3",null,"修改密码",-1)),o(v,{model:a,rules:C,ref_key:"passwordFormRef",ref:b,"label-width":"100px"},{default:s(()=>[o(d,{label:"当前密码",prop:"currentPassword"},{default:s(()=>[o(t,{modelValue:a.currentPassword,"onUpdate:modelValue":e[5]||(e[5]=r=>a.currentPassword=r),type:"password","show-password":"",placeholder:"请输入当前密码"},null,8,["modelValue"])]),_:1}),o(d,{label:"新密码",prop:"newPassword"},{default:s(()=>[o(t,{modelValue:a.newPassword,"onUpdate:modelValue":e[6]||(e[6]=r=>a.newPassword=r),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(d,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[o(t,{modelValue:a.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=r=>a.confirmPassword=r),type:"password","show-password":"",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[o(n,{type:"primary",onClick:I,loading:_.value},{default:s(()=>[...e[11]||(e[11]=[V(" 修改密码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])])}}},D=B(G,[["__scopeId","data-v-9d8b43c6"]]);export{D as default};
