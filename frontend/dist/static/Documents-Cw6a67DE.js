import{_ as ze,u as Fe,r as _,p as $e,c as f,o as p,b as o,d as t,h as n,w as a,f as x,I as Ee,e as i,t as u,J as Be,F as P,s as A,z as D,q as R,K as Pe,E as c,G as w,D as Ae,j as Re,L as Le,M as Te,v as Me}from"./index-Dw5cNvgt.js";const Se={class:"documents-container"},je={class:"page-header"},Ie={class:"header-content"},Ne={class:"header-actions"},qe={class:"stats-cards"},Oe={class:"stat-card"},We={class:"stat-content"},Ke={class:"stat-number"},Ze={class:"stat-card"},Ge={class:"stat-content"},Je={class:"stat-number"},He={class:"stat-card"},Qe={class:"stat-content"},Xe={class:"stat-number"},Ye={class:"stat-card"},el={class:"stat-content"},ll={class:"stat-number"},tl={class:"search-filter-section"},al={class:"search-bar"},ol={class:"filter-controls"},sl={class:"documents-content"},nl={class:"card-header"},dl={class:"view-controls"},il={key:0,class:"card-view"},rl={class:"document-card"},ul={class:"document-icon"},cl={class:"file-type-icon"},pl={class:"file-type"},_l={class:"document-info"},ml=["title"],fl={key:0,class:"document-desc"},vl={class:"document-meta"},gl={class:"meta-item"},yl={class:"meta-item"},bl={key:1,class:"document-category"},wl={key:2,class:"document-tags"},Vl={key:0,class:"more-tags"},kl={class:"document-actions"},hl={key:1,class:"list-view"},Cl={class:"file-icon"},xl={class:"document-name"},Dl={class:"title"},Ul={class:"filename"},zl={key:1,class:"text-gray"},Fl={class:"dialog-footer"},$l={class:"dialog-footer"},El={__name:"Documents",setup(Bl){const U=Re(),k=Fe(),z=_([]),M=_([]),F=_({}),S=_(""),j=_(""),I=_(""),N=_("-created_at"),q=_("card"),$=_(!1),E=_(!1),O=_(!1),r=_({title:"",description:"",file:null,category:"",tags:"",is_public:!1}),v=_({name:"",description:"",color:"#1890ff"}),J=_([]),re=[{label:"PDF文档",value:"pdf"},{label:"Word文档",value:"doc"},{label:"Word文档",value:"docx"},{label:"文本文件",value:"txt"},{label:"Markdown",value:"md"},{label:"PowerPoint",value:"ppt"},{label:"PowerPoint",value:"pptx"},{label:"Excel表格",value:"xls"},{label:"Excel表格",value:"xlsx"},{label:"图片文件",value:"image"},{label:"其他文件",value:"other"}],ue={title:[{required:!0,message:"请输入文档标题",trigger:"blur"}],file:[{required:!0,message:"请选择要上传的文件",trigger:"change"}]},ce={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},W=_(),K=_(),B=async()=>{var s;try{const e={search:S.value,category:j.value,file_type:I.value,ordering:N.value},m=await w.get("/documents/list/",{params:e});z.value=m.data.results||m.data}catch(e){((s=e.response)==null?void 0:s.status)===401?(c.warning("登录已过期，请重新登录"),k.clearAuth(),U.push("/login")):c.error("获取文档列表失败"),console.error("Error fetching documents:",e)}},H=async()=>{var s;try{const e=await w.get("/documents/categories/");M.value=e.data.results||e.data}catch(e){((s=e.response)==null?void 0:s.status)===401?(c.warning("登录已过期，请重新登录"),k.clearAuth(),U.push("/login")):c.error("获取分类列表失败"),console.error("Error fetching categories:",e)}},L=async()=>{var s;try{const e=await w.get("/documents/stats/");F.value=e.data}catch(e){((s=e.response)==null?void 0:s.status)===401?(c.warning("登录已过期，请重新登录"),k.clearAuth(),U.push("/login")):c.error("获取统计信息失败"),console.error("Error fetching stats:",e)}},pe=()=>{$.value=!0,r.value={title:"",description:"",file:null,category:"",tags:"",is_public:!1},J.value=[]},_e=()=>{E.value=!0,v.value={name:"",description:"",color:"#1890ff"}},me=s=>{r.value.file=s.raw,r.value.title||(r.value.title=s.name.split(".")[0])},fe=async()=>{W.value&&await W.value.validate(async s=>{var e,m;if(s){O.value=!0;const d=new FormData;d.append("file",r.value.file),d.append("title",r.value.title),d.append("description",r.value.description),d.append("tags",r.value.tags),d.append("is_public",r.value.is_public),r.value.category&&d.append("category",r.value.category);try{await w.post("/documents/upload/",d,{headers:{"Content-Type":"multipart/form-data"}}),c.success("文档上传成功"),$.value=!1,B(),L()}catch(V){c.error(((m=(e=V.response)==null?void 0:e.data)==null?void 0:m.errors)||"上传失败")}finally{O.value=!1}}})},ve=async()=>{K.value&&await K.value.validate(async s=>{if(s)try{await w.post("/documents/categories/",v.value),c.success("分类创建成功"),E.value=!1,H(),L()}catch{c.error("创建分类失败")}})},ge=()=>{B()},Z=()=>{B()},Q=async s=>{try{await w.get(`/documents/${s.id}/`),c.success("查看文档")}catch{c.error("无法查看文档")}},X=async s=>{try{const e=await w.get(`/documents/${s.id}/download/`,{responseType:"blob"}),m=window.URL.createObjectURL(new Blob([e.data])),d=s.createElement("a");d.href=m,d.setAttribute("download",s.original_filename),s.body.appendChild(d),d.click(),d.remove(),c.success("下载开始")}catch{c.error("下载失败")}},Y=s=>{c.info("编辑功能开发中")},ee=async s=>{try{await Ae.confirm(`确定要删除文档 "${s.title}" 吗？此操作不可撤销。`,"确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await w.delete(`/documents/${s.id}/delete/`),c.success("文档删除成功"),B(),L()}catch(e){e!=="cancel"&&c.error("删除失败")}},ye=s=>{s.action==="edit"?Y(s.doc):s.action==="delete"&&ee(s.doc)},le=s=>new Date(s).toLocaleDateString("zh-CN"),be=async()=>(console.log("检查认证状态:",k.isLoggedIn),k.isLoggedIn?await k.validateToken()?!0:(c.warning("登录已过期，请重新登录"),U.push("/login"),!1):(c.warning("请先登录后访问文档管理页面"),U.push("/login"),!1)),we=async()=>{if(await be())try{await Promise.all([B(),H(),L()])}catch(e){console.error("初始化数据加载失败:",e),c.error("页面数据加载失败，请刷新重试")}};return $e(()=>{we()}),(s,e)=>{const m=i("el-icon"),d=i("el-button"),V=i("el-col"),te=i("el-row"),h=i("el-input"),y=i("el-option"),T=i("el-select"),ae=i("el-radio-button"),oe=i("el-radio-group"),G=i("el-tag"),se=i("el-dropdown-item"),Ve=i("el-dropdown-menu"),ke=i("el-dropdown"),C=i("el-table-column"),he=i("el-table"),Ce=i("el-empty"),xe=i("el-card"),De=i("el-upload"),g=i("el-form-item"),ne=i("el-radio"),de=i("el-form"),ie=i("el-dialog"),Ue=i("el-color-picker");return p(),f("div",Se,[o("div",je,[o("div",Ie,[o("h1",null,[t(m,null,{default:a(()=>[t(x(Ee))]),_:1}),e[17]||(e[17]=n(" 文献资料管理 ",-1))]),e[18]||(e[18]=o("p",null,"管理您的文献资料，支持多种文件格式的上传和分类整理",-1))]),o("div",Ne,[t(d,{type:"primary",onClick:pe,icon:"Plus"},{default:a(()=>[...e[19]||(e[19]=[n(" 上传文档 ",-1)])]),_:1}),t(d,{onClick:_e,icon:"FolderAdd"},{default:a(()=>[...e[20]||(e[20]=[n(" 新建分类 ",-1)])]),_:1})])]),o("div",qe,[t(te,{gutter:20},{default:a(()=>[t(V,{span:6},{default:a(()=>[o("div",Oe,[e[22]||(e[22]=o("div",{class:"stat-icon documents"},"📚",-1)),o("div",We,[o("div",Ke,u(F.value.total_documents),1),e[21]||(e[21]=o("div",{class:"stat-label"},"文档总数",-1))])])]),_:1}),t(V,{span:6},{default:a(()=>[o("div",Ze,[e[24]||(e[24]=o("div",{class:"stat-icon categories"},"🗂️",-1)),o("div",Ge,[o("div",Je,u(F.value.total_categories),1),e[23]||(e[23]=o("div",{class:"stat-label"},"分类数量",-1))])])]),_:1}),t(V,{span:6},{default:a(()=>[o("div",He,[e[26]||(e[26]=o("div",{class:"stat-icon size"},"💾",-1)),o("div",Qe,[o("div",Xe,u(F.value.total_size_human),1),e[25]||(e[25]=o("div",{class:"stat-label"},"总存储",-1))])])]),_:1}),t(V,{span:6},{default:a(()=>[o("div",Ye,[e[28]||(e[28]=o("div",{class:"stat-icon types"},"🎯",-1)),o("div",el,[o("div",ll,u(Object.keys(F.value.file_type_stats||{}).length),1),e[27]||(e[27]=o("div",{class:"stat-label"},"文件类型",-1))])])]),_:1})]),_:1})]),o("div",tl,[o("div",al,[t(h,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=l=>S.value=l),placeholder:"搜索文档标题、描述或标签...",onInput:ge,clearable:""},{prefix:a(()=>[t(m,null,{default:a(()=>[t(x(Be))]),_:1})]),_:1},8,["modelValue"])]),o("div",ol,[t(T,{modelValue:j.value,"onUpdate:modelValue":e[1]||(e[1]=l=>j.value=l),placeholder:"选择分类",onChange:Z,clearable:""},{default:a(()=>[(p(!0),f(P,null,A(M.value,l=>(p(),D(y,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(T,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=l=>I.value=l),placeholder:"文件类型",onChange:Z,clearable:""},{default:a(()=>[(p(),f(P,null,A(re,l=>t(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),t(T,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=l=>N.value=l),placeholder:"排序方式",onChange:Z},{default:a(()=>[t(y,{label:"最新上传",value:"-created_at"}),t(y,{label:"最早上传",value:"created_at"}),t(y,{label:"标题 A-Z",value:"title"}),t(y,{label:"标题 Z-A",value:"-title"}),t(y,{label:"文件大小",value:"file_size"})]),_:1},8,["modelValue"])])]),o("div",sl,[t(xe,{class:"documents-list-card"},{header:a(()=>[o("div",nl,[o("span",null,"文档列表 ("+u(z.value.length)+")",1),o("div",dl,[t(oe,{modelValue:q.value,"onUpdate:modelValue":e[4]||(e[4]=l=>q.value=l),size:"small"},{default:a(()=>[t(ae,{label:"card"},{default:a(()=>[...e[29]||(e[29]=[n("卡片",-1)])]),_:1}),t(ae,{label:"list"},{default:a(()=>[...e[30]||(e[30]=[n("列表",-1)])]),_:1})]),_:1},8,["modelValue"])])])]),default:a(()=>[q.value==="card"?(p(),f("div",il,[t(te,{gutter:20},{default:a(()=>[(p(!0),f(P,null,A(z.value,l=>(p(),D(V,{span:6,key:l.id},{default:a(()=>[o("div",rl,[o("div",ul,[o("span",cl,u(l.file_type_icon),1),o("span",pl,u(l.file_type.toUpperCase()),1)]),o("div",_l,[o("h3",{class:"document-title",title:l.title},u(l.title),9,ml),l.description?(p(),f("p",fl,u(l.description),1)):R("",!0),o("div",vl,[o("div",gl,[t(m,null,{default:a(()=>[t(x(Le))]),_:1}),n(" "+u(le(l.created_at)),1)]),o("div",yl,[t(m,null,{default:a(()=>[t(x(Te))]),_:1}),n(" "+u(l.file_size_human),1)])]),l.category_name?(p(),f("div",bl,[t(G,{color:l.category_color,size:"small"},{default:a(()=>[n(u(l.category_name),1)]),_:2},1032,["color"])])):R("",!0),l.tags_list.length?(p(),f("div",wl,[(p(!0),f(P,null,A(l.tags_list.slice(0,3),b=>(p(),D(G,{key:b,size:"small",type:"info"},{default:a(()=>[n(u(b),1)]),_:2},1024))),128)),l.tags_list.length>3?(p(),f("span",Vl," +"+u(l.tags_list.length-3),1)):R("",!0)])):R("",!0)]),o("div",kl,[t(d,{size:"small",onClick:b=>Q(l)},{default:a(()=>[...e[31]||(e[31]=[n(" 查看 ",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",onClick:b=>X(l),type:"primary"},{default:a(()=>[...e[32]||(e[32]=[n(" 下载 ",-1)])]),_:1},8,["onClick"]),t(ke,{onCommand:ye},{dropdown:a(()=>[t(Ve,null,{default:a(()=>[t(se,{command:{action:"edit",doc:l}},{default:a(()=>[...e[34]||(e[34]=[n(" 编辑 ",-1)])]),_:1},8,["command"]),t(se,{command:{action:"delete",doc:l},divided:""},{default:a(()=>[...e[35]||(e[35]=[n(" 删除 ",-1)])]),_:1},8,["command"])]),_:2},1024)]),default:a(()=>[t(d,{size:"small",type:"info"},{default:a(()=>[e[33]||(e[33]=n(" 更多",-1)),t(m,{class:"el-icon--right"},{default:a(()=>[t(x(Me))]),_:1})]),_:1})]),_:2},1024)])])]),_:2},1024))),128))]),_:1})])):(p(),f("div",hl,[t(he,{data:z.value,stripe:""},{default:a(()=>[t(C,{width:"60"},{default:a(({row:l})=>[o("span",Cl,u(l.file_type_icon),1)]),_:1}),t(C,{label:"文档名称","min-width":"200"},{default:a(({row:l})=>[o("div",xl,[o("div",Dl,u(l.title),1),o("div",Ul,u(l.original_filename),1)])]),_:1}),t(C,{label:"分类",width:"120"},{default:a(({row:l})=>[l.category_name?(p(),D(G,{key:0,color:l.category_color,size:"small"},{default:a(()=>[n(u(l.category_name),1)]),_:2},1032,["color"])):(p(),f("span",zl,"未分类"))]),_:1}),t(C,{label:"文件大小",width:"100"},{default:a(({row:l})=>[n(u(l.file_size_human),1)]),_:1}),t(C,{label:"上传时间",width:"150"},{default:a(({row:l})=>[n(u(le(l.created_at)),1)]),_:1}),t(C,{label:"操作",width:"200"},{default:a(({row:l})=>[t(d,{size:"small",onClick:b=>Q(l)},{default:a(()=>[...e[36]||(e[36]=[n(" 查看 ",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"primary",onClick:b=>X(l)},{default:a(()=>[...e[37]||(e[37]=[n(" 下载 ",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",onClick:b=>Y(l)},{default:a(()=>[...e[38]||(e[38]=[n(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"danger",onClick:b=>ee(l)},{default:a(()=>[...e[39]||(e[39]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])),z.value.length===0?(p(),D(Ce,{key:2,description:"暂无文档，点击上传按钮开始添加文档"})):R("",!0)]),_:1})]),t(ie,{modelValue:$.value,"onUpdate:modelValue":e[11]||(e[11]=l=>$.value=l),title:"上传文档",width:"600px"},{footer:a(()=>[o("span",Fl,[t(d,{onClick:e[10]||(e[10]=l=>$.value=!1)},{default:a(()=>[...e[44]||(e[44]=[n("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:fe,loading:O.value},{default:a(()=>[...e[45]||(e[45]=[n(" 上传 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(de,{model:r.value,rules:ue,ref_key:"uploadFormRef",ref:W,"label-width":"100px"},{default:a(()=>[t(g,{label:"选择文件",prop:"file"},{default:a(()=>[t(De,{class:"upload-demo",drag:"","auto-upload":!1,"on-change":me,"file-list":J.value,limit:1,accept:".pdf,.doc,.docx,.txt,.md,.ppt,.pptx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.bmp"},{tip:a(()=>[...e[40]||(e[40]=[o("div",{class:"el-upload__tip"}," 支持 PDF、Word、Excel、PowerPoint、图片等格式，文件大小不超过50MB ",-1)])]),default:a(()=>[t(m,{class:"el-icon--upload"},{default:a(()=>[t(x(Pe))]),_:1}),e[41]||(e[41]=o("div",{class:"el-upload__text"},[n(" 将文件拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1}),t(g,{label:"文档标题",prop:"title"},{default:a(()=>[t(h,{modelValue:r.value.title,"onUpdate:modelValue":e[5]||(e[5]=l=>r.value.title=l),placeholder:"请输入文档标题"},null,8,["modelValue"])]),_:1}),t(g,{label:"文档描述"},{default:a(()=>[t(h,{modelValue:r.value.description,"onUpdate:modelValue":e[6]||(e[6]=l=>r.value.description=l),type:"textarea",rows:3,placeholder:"请输入文档描述（可选）"},null,8,["modelValue"])]),_:1}),t(g,{label:"选择分类"},{default:a(()=>[t(T,{modelValue:r.value.category,"onUpdate:modelValue":e[7]||(e[7]=l=>r.value.category=l),placeholder:"选择分类",clearable:""},{default:a(()=>[(p(!0),f(P,null,A(M.value,l=>(p(),D(y,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"标签"},{default:a(()=>[t(h,{modelValue:r.value.tags,"onUpdate:modelValue":e[8]||(e[8]=l=>r.value.tags=l),placeholder:"请输入标签，用逗号分隔（可选）"},null,8,["modelValue"])]),_:1}),t(g,{label:"权限设置"},{default:a(()=>[t(oe,{modelValue:r.value.is_public,"onUpdate:modelValue":e[9]||(e[9]=l=>r.value.is_public=l)},{default:a(()=>[t(ne,{label:!1},{default:a(()=>[...e[42]||(e[42]=[n("私有",-1)])]),_:1}),t(ne,{label:!0},{default:a(()=>[...e[43]||(e[43]=[n("公开",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(ie,{modelValue:E.value,"onUpdate:modelValue":e[16]||(e[16]=l=>E.value=l),title:"新建分类",width:"500px"},{footer:a(()=>[o("span",$l,[t(d,{onClick:e[15]||(e[15]=l=>E.value=!1)},{default:a(()=>[...e[46]||(e[46]=[n("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:ve},{default:a(()=>[...e[47]||(e[47]=[n(" 创建 ",-1)])]),_:1})])]),default:a(()=>[t(de,{model:v.value,rules:ce,ref_key:"categoryFormRef",ref:K,"label-width":"100px"},{default:a(()=>[t(g,{label:"分类名称",prop:"name"},{default:a(()=>[t(h,{modelValue:v.value.name,"onUpdate:modelValue":e[12]||(e[12]=l=>v.value.name=l),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),t(g,{label:"分类描述"},{default:a(()=>[t(h,{modelValue:v.value.description,"onUpdate:modelValue":e[13]||(e[13]=l=>v.value.description=l),type:"textarea",rows:3,placeholder:"请输入分类描述（可选）"},null,8,["modelValue"])]),_:1}),t(g,{label:"分类颜色"},{default:a(()=>[t(Ue,{modelValue:v.value.color,"onUpdate:modelValue":e[14]||(e[14]=l=>v.value.color=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Al=ze(El,[["__scopeId","data-v-2008a160"]]);export{Al as default};
