import{_ as N,r as p,a as z,n as K,c as v,o as m,b as o,d as l,w as n,f as d,F as U,q as j,E as f,g as A,j as u,x as G,t as h,s as H,C as J}from"./index-CdnyxSvZ.js";import{u as O}from"./chat-OSkCsiMU.js";const P={class:"sessions-container"},Q={class:"sessions-header"},W={class:"header-actions"},X={class:"sessions-content"},Y={key:0,class:"loading"},Z={key:1,class:"empty-state"},ee={key:2,class:"sessions-list"},te={class:"session-header"},se={class:"session-info"},oe=["onClick"],ne={class:"session-meta"},le={class:"message-count"},ae={class:"session-time"},ie={class:"session-actions"},re={class:"session-content"},de={class:"session-date"},ce={class:"session-updated"},ue={__name:"ChatSessions",setup(me){const V=A(),y=O(),g=p(!1),c=p([]),_=p(!1),k=p(!1),C=p(),i=z({title:"",sessionId:null}),D=t=>{const e=new Date(t),r=new Date-e;return r<6e4?"刚刚":r<36e5?`${Math.floor(r/6e4)}分钟前`:r<864e5?`${Math.floor(r/36e5)}小时前`:r<6048e5?`${Math.floor(r/864e5)}天前`:e.toLocaleDateString()},w=t=>new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),I=async()=>{g.value=!0;try{const t=await y.fetchSessions();t.success?c.value=y.sessions:f.error(t.error)}catch(t){console.error("获取会话列表失败:",t),f.error("获取会话列表失败")}finally{g.value=!1}},B=t=>{V.push({path:"/chat",query:{sessionId:t}})},F=t=>{i.title=t.title||"新对话",i.sessionId=t.id,_.value=!0},S=()=>{_.value=!1,i.title="",i.sessionId=null},$=async()=>{if(C.value)try{await C.value.validate(),k.value=!0;const t=await y.renameSession(i.sessionId,i.title);if(t.success){f.success("重命名成功"),_.value=!1;const e=c.value.findIndex(a=>a.id===i.sessionId);e!==-1&&(c.value[e].title=i.title)}else f.error(t.error)}catch(t){console.error("重命名失败:",t)}finally{k.value=!1}},M=t=>{J.confirm(`确定要删除对话"${t.title||"新对话"}"吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{const e=await y.deleteSession(t.id);e.success?(f.success("删除成功"),c.value=c.value.filter(a=>a.id!==t.id)):f.error(e.error)}).catch(()=>{})};return K(()=>{I()}),(t,e)=>{const a=d("el-button"),r=d("el-skeleton"),R=d("el-empty"),T=d("el-card"),b=d("el-input"),E=d("el-form-item"),L=d("el-form"),q=d("el-dialog");return m(),v("div",P,[o("div",Q,[e[7]||(e[7]=o("h2",null,"会话管理",-1)),o("div",W,[l(a,{onClick:e[0]||(e[0]=s=>t.$router.push("/chat")),type:"primary",icon:"ChatDotSquare"},{default:n(()=>[...e[5]||(e[5]=[u(" 新建对话 ",-1)])]),_:1}),l(a,{onClick:e[1]||(e[1]=s=>t.$router.go(-1)),icon:"ArrowLeft"},{default:n(()=>[...e[6]||(e[6]=[u("返回",-1)])]),_:1})])]),o("div",X,[g.value?(m(),v("div",Y,[l(r,{rows:5,animated:""})])):c.value.length===0?(m(),v("div",Z,[l(R,{description:"暂无对话记录"},{default:n(()=>[l(a,{type:"primary",onClick:e[2]||(e[2]=s=>t.$router.push("/chat"))},{default:n(()=>[...e[8]||(e[8]=[u(" 开始对话 ",-1)])]),_:1})]),_:1})])):(m(),v("div",ee,[(m(!0),v(U,null,j(c.value,s=>(m(),G(T,{key:s.id,class:"session-card",shadow:"hover"},{header:n(()=>[o("div",te,[o("div",se,[o("h4",{class:"session-title",onClick:x=>B(s.id)},h(s.title||"新对话"),9,oe),o("div",ne,[o("span",le,h(s.message_count||0)+" 条消息",1),o("span",ae,h(D(s.updated_at)),1)])]),o("div",ie,[l(a,{size:"small",icon:"Edit",onClick:x=>F(s)},{default:n(()=>[...e[9]||(e[9]=[u(" 重命名 ",-1)])]),_:1},8,["onClick"]),l(a,{size:"small",type:"danger",icon:"Delete",onClick:x=>M(s)},{default:n(()=>[...e[10]||(e[10]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])])])]),default:n(()=>[o("div",re,[o("div",de," 创建时间："+h(w(s.created_at)),1),o("div",ce," 更新时间："+h(w(s.updated_at)),1)])]),_:2},1024))),128))]))]),l(q,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s),title:"重命名对话",width:"400px",onClose:S},{footer:n(()=>[l(a,{onClick:S},{default:n(()=>[...e[11]||(e[11]=[u("取消",-1)])]),_:1}),l(a,{type:"primary",onClick:$,loading:k.value},{default:n(()=>[...e[12]||(e[12]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[l(L,{model:i,ref_key:"renameFormRef",ref:C},{default:n(()=>[l(E,{label:"对话标题",rules:[{required:!0,message:"请输入对话标题"}],prop:"title"},{default:n(()=>[l(b,{modelValue:i.title,"onUpdate:modelValue":e[3]||(e[3]=s=>i.title=s),placeholder:"请输入新的对话标题",maxlength:"100","show-word-limit":"",onKeyup:H($,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},pe=N(ue,[["__scopeId","data-v-cede5a53"]]);export{pe as default};
