import{_ as j,u as q,r as C,k as P,n as R,c as d,o as l,p as b,b as s,h as n,d as a,w as i,f as _,F as I,q as S,t as f,s as B,e as E,v as M,g as G,j as u,x as L,y as J,z as O,E as V,A as Q}from"./index-CdnyxSvZ.js";import{u as W}from"./chat-OSkCsiMU.js";const X={class:"chat-container"},Y={key:0,class:"sidebar"},Z={class:"session-header"},ee={class:"session-list"},se=["onClick"],te={class:"session-title"},oe={class:"session-time"},ne={class:"chat-header"},le={class:"header-left"},ae={key:0},ie={key:1},de={class:"header-right"},re={key:0,class:"user-actions"},ue={class:"el-dropdown-link"},ce={key:1,class:"auth-buttons"},_e={key:0,class:"welcome-message"},me={class:"message-avatar"},pe={class:"message-content"},ve={class:"message-text"},fe={class:"message-time"},ge={key:1,class:"message ai-message"},he={class:"message-avatar"},ye={class:"input-container"},we={class:"input-wrapper"},ke={__name:"Chat",setup(Ce){const x=G(),c=q(),o=W(),p=C(""),h=C(),v=C(null);P(()=>c.isLoggedIn);const A=r=>{const e=new Date(r),m=new Date-e;return m<6e4?"刚刚":m<36e5?`${Math.floor(m/6e4)}分钟前`:m<864e5?`${Math.floor(m/36e5)}小时前`:e.toLocaleDateString()},y=async()=>{if(!p.value.trim())return;const r=p.value.trim();p.value="";const e=await o.sendMessage(r,v.value,o.selectedModel);e.success?(e.sessionId&&!v.value&&(v.value=e.sessionId,c.isLoggedIn&&o.fetchSessions()),$()):V.error(e.error)},$=()=>{Q(()=>{h.value&&(h.value.scrollTop=h.value.scrollHeight)})},z=()=>{v.value=null,o.clearCurrentSession()},N=async r=>{v.value=r;const e=await o.fetchSessionHistory(r);e.success?$():V.error(e.error)},T=r=>{switch(r){case"profile":x.push("/profile");break;case"sessions":x.push("/sessions");break;case"logout":c.logout(),V.success("已退出登录"),z(),o.sessions=[];break}};return R(async()=>{await o.fetchAvailableModels(),c.isLoggedIn&&await o.fetchSessions(),c.initAuth()}),(r,e)=>{const g=_("el-button"),m=_("el-option"),D=_("el-select"),U=_("el-icon"),w=_("el-dropdown-item"),K=_("el-dropdown-menu"),F=_("el-dropdown"),k=_("el-avatar"),H=_("el-input");return l(),d("div",X,[n(c).isLoggedIn?(l(),d("div",Y,[s("div",Z,[a(g,{type:"primary",onClick:z,icon:"Plus",size:"small"},{default:i(()=>[...e[4]||(e[4]=[u(" 新建对话 ",-1)])]),_:1})]),s("div",ee,[(l(!0),d(I,null,S(n(o).sessions,t=>(l(),d("div",{key:t.id,class:M(["session-item",{active:v.value===t.id}]),onClick:be=>N(t.id)},[s("div",te,f(t.title||"新对话"),1),s("div",oe,f(A(t.updated_at)),1)],10,se))),128))])])):b("",!0),s("div",{class:M(["chat-main",{"full-width":!n(c).isLoggedIn}])},[s("div",ne,[s("div",le,[n(o).currentSession?(l(),d("h3",ae,f(n(o).currentSession.title||"新对话"),1)):(l(),d("h3",ie,"AI 智能助手"))]),s("div",de,[a(D,{modelValue:n(o).selectedModel,"onUpdate:modelValue":e[0]||(e[0]=t=>n(o).selectedModel=t),placeholder:"选择模型",size:"small",style:{width:"200px"}},{default:i(()=>[(l(!0),d(I,null,S(n(o).availableModels,t=>(l(),L(m,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(c).isLoggedIn?(l(),d("div",re,[a(F,{onCommand:T},{dropdown:i(()=>[a(K,null,{default:i(()=>[a(w,{command:"profile"},{default:i(()=>[...e[5]||(e[5]=[u("个人资料",-1)])]),_:1}),a(w,{command:"sessions"},{default:i(()=>[...e[6]||(e[6]=[u("会话管理",-1)])]),_:1}),a(w,{command:"logout",divided:""},{default:i(()=>[...e[7]||(e[7]=[u("退出登录",-1)])]),_:1})]),_:1})]),default:i(()=>[s("span",ue,[u(f(n(c).username)+" ",1),a(U,null,{default:i(()=>[a(n(J))]),_:1})])]),_:1})])):(l(),d("div",ce,[a(g,{size:"small",onClick:e[1]||(e[1]=t=>r.$router.push("/login"))},{default:i(()=>[...e[8]||(e[8]=[u("登录",-1)])]),_:1}),a(g,{type:"primary",size:"small",onClick:e[2]||(e[2]=t=>r.$router.push("/register"))},{default:i(()=>[...e[9]||(e[9]=[u("注册",-1)])]),_:1})]))])]),s("div",{class:"messages-container",ref_key:"messagesContainer",ref:h},[n(o).messages.length===0?(l(),d("div",_e,[...e[10]||(e[10]=[s("h2",null,"欢迎使用 AI 智能助手",-1),s("p",null,"您可以向我提问任何问题，我会尽力为您解答。",-1)])])):b("",!0),(l(!0),d(I,null,S(n(o).messages,t=>(l(),d("div",{key:t.id,class:M(["message",{"user-message":t.is_user,"ai-message":!t.is_user}])},[s("div",me,[t.is_user?(l(),L(k,{key:0,icon:n(O)},null,8,["icon"])):(l(),L(k,{key:1,style:{"background-color":"#409eff"}},{default:i(()=>[...e[11]||(e[11]=[u("AI",-1)])]),_:1}))]),s("div",pe,[s("div",ve,f(t.content),1),s("div",fe,f(A(t.created_at)),1)])],2))),128)),n(o).isLoading?(l(),d("div",ge,[s("div",he,[a(k,{style:{"background-color":"#409eff"}},{default:i(()=>[...e[12]||(e[12]=[u("AI",-1)])]),_:1})]),e[13]||(e[13]=s("div",{class:"message-content"},[s("div",{class:"typing-indicator"},[s("span"),s("span"),s("span")])],-1))])):b("",!0)],512),s("div",ye,[s("div",we,[a(H,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=t=>p.value=t),type:"textarea",rows:3,placeholder:"输入您的问题...",disabled:n(o).isLoading,onKeydown:[B(E(y,["ctrl"]),["enter"]),B(E(y,["exact","prevent"]),["enter"])]},null,8,["modelValue","disabled","onKeydown"]),a(g,{type:"primary",onClick:y,loading:n(o).isLoading,disabled:!p.value.trim()},{default:i(()=>[...e[14]||(e[14]=[u(" 发送 ",-1)])]),_:1},8,["loading","disabled"])]),e[15]||(e[15]=s("div",{class:"input-hint"}," 按 Enter 发送，Ctrl + Enter 换行 ",-1))])],2)])}}},Me=j(ke,[["__scopeId","data-v-330061d3"]]);export{Me as default};
